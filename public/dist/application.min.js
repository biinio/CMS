"use strict";function GalleryController($scope,$modalInstance,$http,galleries,Organization){$scope.organizationService=Organization,$scope.render=!0,$scope.loadingImages=!1,$scope.croppingImages=!1,$scope.galleries=galleries,console.log($scope.galleries),$scope.reset=function(){$scope.myImage="",$scope.myCroppedImage="",$scope.imgcropType="square"},$scope.image={image:"",cropImage:""},$scope.reset(),$scope.$on("Biin: on fileUploaded",function(scope,event){$scope.image.image=event.target.result,$scope.filename=event.target.filename,$scope.croppingImages=!0,$scope.loadingImages=!1,$scope.$digest()}),$scope.loadingImagesChange=function(state){$scope.loadingImages=state,$scope.$digest()},$scope.onGalleryChange=function(obj,autoInsert){if($scope.galleries=$scope.galleries.concat(obj),autoInsert){var cantToInsert=obj.length;maxMedia>0&&(cantToInsert=$scope.maxMedia-$scope.sites[$scope.selectedSite].media.length);for(var i=0;cantToInsert>i;i++)$scope.insertGalleryItem($scope.galleries.indexOf(obj[i]))}},$scope.uploadImage=function(){$scope.image.cropImage},$scope.uploadImageToServer=function(){var myImage=$scope.image.cropImage,filename=$scope.filename;$scope.croppingImages=!1,$scope.loadingImages=!0,$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/gallery/upload",{images:[{image:myImage,fileName:filename}]}).success(function(data){$scope.onGalleryChange(data),$scope.croppingImages=!1,$scope.loadingImages=!1}).error(function(){$scope.croppingImages=!1,$scope.loadingImages=!1})},$scope.confirmDeleteImage=function(message){confirm(message)&&$scope["delete"]()},$scope["delete"]=function(){var imagesToDelete=[],imageIndex=[];$(".galleryImageWrapper").each(function(index,element){$(element).hasClass("selected")&&(imagesToDelete.push($scope.galleries[index]),imageIndex.push(index))});for(var index=0;index<imagesToDelete.length;index++)$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/checkImage/"+imagesToDelete[index].identifier).success(function(data){1==data.deleted&&$scope.galleries.splice(imageIndex[index],1)}).error(function(msg){console.log(msg)});var modalInfo={};modalInfo.galleries=$scope.galleries,$modalInstance.dismiss(modalInfo)},$scope.apply=function(){var selectedImages=[];$(".galleryImageWrapper").each(function(index,element){$(element).hasClass("selected")&&selectedImages.push($scope.galleries[index])});var modalInfo={};modalInfo.selectedImages=selectedImages,modalInfo.galleries=$scope.galleries,$modalInstance.close(modalInfo)},$scope.close=function(){var modalInfo={};modalInfo.galleries=$scope.galleries,$modalInstance.dismiss(modalInfo)}}function GmapController($scope,$modalInstance){$scope.render=!0,$scope.lat=0,$scope.lng=0,$scope.changeLocation=function(lat,lng){$scope.lat=lat,$scope.lng=lng},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.apply=function(){var newPos={};newPos.lat=$scope.lat,newPos.lng=$scope.lng,$modalInstance.close(newPos)}}var ApplicationConfiguration=function(){var applicationModuleName="BiinCMSApp",applicationBackendURL=window.location.href.indexOf("dev")>-1?"https://dev-biin-backend.herokuapp.com/":window.location.href.indexOf("qa")>-1?"https://qa-biin-backend.herokuapp.com/":window.location.href.indexOf("demo")>-1?"https://demo-biin-backend.herokuapp.com/":window.location.href.indexOf("production")>-1?"https://www.biin.io/":window.location.href.indexOf("biin.io")>-1?"https://www.biin.io/":window.location.href.indexOf("localhost")>-1?"https://dev-biin-backend.herokuapp.com/":"",applicationModuleVendorDependencies=["ngRoute","ngAnimate","ngStorage","ngTouch","ngCookies","pascalprecht.translate","ui.bootstrap","ui.router","oc.lazyLoad","cfp.loadingBar","ngSanitize","ngResource","ui.utils","ngAnimate","toaster","textAngular","bootstrap-tagsinput","angular-bind-html-compile","datePicker","ui.bootstrap-slider","ngDragDrop","nvd3","ngImgCrop","color.picker"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule,applicationBackendURL:applicationBackendURL}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("basiccms"),ApplicationConfiguration.registerModule("biinUsers"),ApplicationConfiguration.registerModule("biins"),function(){ApplicationConfiguration.registerModule("app.colors")}(),function(){ApplicationConfiguration.registerModule("app.core",["app.routes","app.sidebar","app.navsearch","app.preloader","app.loadingbar","app.translate","app.settings","app.forms","app.utils","app.panels"])}(),ApplicationConfiguration.registerModule("dashboard"),ApplicationConfiguration.registerModule("elements"),ApplicationConfiguration.registerModule("app.forms"),ApplicationConfiguration.registerModule("gallery"),ApplicationConfiguration.registerModule("gmaps"),function(){ApplicationConfiguration.registerModule("app.lazyload")}(),function(){ApplicationConfiguration.registerModule("app.loadingbar")}(),ApplicationConfiguration.registerModule("maintenance"),function(){ApplicationConfiguration.registerModule("app.navsearch")}(),ApplicationConfiguration.registerModule("nps",["app.translate"]),ApplicationConfiguration.registerModule("objectssidebar"),ApplicationConfiguration.registerModule("organization",["app.translate"]),ApplicationConfiguration.registerModule("page"),function(){angular.module("app.panels",[])}(),function(){ApplicationConfiguration.registerModule("app.preloader")}(),ApplicationConfiguration.registerModule("profile",["app.translate"]),function(){ApplicationConfiguration.registerModule("app.routes",["app.lazyload"])}(),function(){ApplicationConfiguration.registerModule("app.settings")}(),ApplicationConfiguration.registerModule("showcases"),function(){ApplicationConfiguration.registerModule("app.sidebar")}(),ApplicationConfiguration.registerModule("sites"),function(){ApplicationConfiguration.registerModule("app.translate")}(),ApplicationConfiguration.registerModule("users"),function(){ApplicationConfiguration.registerModule("app.utils",["app.colors"])}(),angular.module("basiccms").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.basiccms",{url:"/basiccms",templateUrl:"modules/basiccms/views/basic.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function BasicCMSController($http,$state,$scope,$modal,Authentication,Organization,ObjectsSidebar,Loading){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization}$scope.objectsSidebarService=ObjectsSidebar,$scope.objectsSidebarService.enableAddButton=!1,$scope.getSiteName=function(identifier){var site=_.findWhere($scope.sites,{identifier:identifier});return site?site.title1+" "+site.title2:""},$scope.getObjectName=function(identifier,type){if(identifier&&type)if("1"===type){var el=_.findWhere($scope.elements,{elementIdentifier:identifier});if(el)return el.title}else{var sh=_.findWhere($scope.showcases,{identifier:identifier});if(sh)return sh.name}return"name not available"},$scope.removeObject=function(index){$scope.objectsSidebarService.selectedObject.objects.splice(index,1),$scope.biins=$scope.objectsSidebarService.getObjects()},$scope.save=function(){null!=$scope.objectsSidebarService.selectedObject&&$http.put(ApplicationConfiguration.applicationBackendURL+"api/venues/create",null,{headers:{name:$scope.objectsSidebarService.selectedObject.venue,orgidentifier:$scope.organizationId}}).success(function(){$http.post(ApplicationConfiguration.applicationBackendURL+"api/biins/"+$scope.objectsSidebarService.selectedObject.identifier+"/update",$scope.objectsSidebarService.selectedObject).success(function(){console.log("success")}).error(function(err){console.log(err)})})};activate(),$scope.objectsSidebarService=ObjectsSidebar,$scope.sidebarTemplate="<div class='col-md-12 leftInformationArea' style='padding-left: 10px'><label class='threeRowTitle'>{{item.name}}</label><localization class='threeRowSubTitle' style='display: block'></localization><p class='threeRowThirdLine'>{{item.status}}</p></div>",$scope.objectsSidebarService.template=$scope.sidebarTemplate,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.$on("organizationChanged",function(){$scope.objectsSidebarService.selectedObject=null,$scope.objectsSidebarService.objects=[],$scope.loadingService.isLoading=!0,$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/sites/").success(function(data){$scope.sites=data.data.sites,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/readyElementser/").success(function(data){$scope.elements=data.data.elements,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/showcases/").success(function(data){$scope.showcases=data.data,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/biins/").success(function(data){$scope.biins=data.data,$scope.objectsSidebarService.setObjects(data.data),$scope.loadingService.isLoading=!1}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}),$scope.$on("Biin: On Object Clicked",function(event,objectClicked){}),$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/sites/").success(function(data){$scope.sites=data.data.sites,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/readyElements/").success(function(data){$scope.elements=data.data.elements,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/showcases/").success(function(data){$scope.showcases=data.data,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/biins/").success(function(data){$scope.biins=data.data,$scope.objectsSidebarService.setObjects(data.data),$scope.loadingService.isLoading=!1}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)}),$scope.saveObject=function(obj){obj&&"isNew"in obj&&(delete obj.isNew,$scope.objectsSidebarService.selectedObject.objects.push(obj),$scope.biins=$scope.objectsSidebarService.getObjects())},$scope.getVenues=function(val){return $http.get(ApplicationConfiguration.applicationBackendURL+"api/venues/search",{headers:{regex:val,orgidentifier:$scope.organizationId}}).then(function(response){return response.data})},$scope.convertTime=function(time){var hours=parseInt(time),min=60*(parseFloat(time)-hours),hoursString=10>hours?"0"+hours:""+hours,minString=10>min?"0"+min:""+min;return hoursString+":"+minString},$scope.biinObject=function(size,type,obj){var modalInstance=$modal.open({templateUrl:"/modules/biins/views/partials/biin.client.modal.view.html",controller:"biinsModalController",size:size,resolve:{selectedObj:function(){return"create"===type?{type:type}:{type:type,obj:obj}},elements:function(){return $scope.elements},showcases:function(){return $scope.showcases}}});modalInstance.result.then(function(objectToCreate){$scope.saveObject(objectToCreate)},function(){})}}angular.module("basiccms").controller("BasicCMSController",BasicCMSController),BasicCMSController.$inject=["$http","$state","$scope","$modal","Authentication","Organization","ObjectsSidebar","Loading"]}(),angular.module("biinUsers").config(["$stateProvider",function($stateProvider){$stateProvider.state("page.login",{url:"/login",templateUrl:"modules/biinUsers/views/login.client.view.html"})}]),function(){function LoginFormController($http,$state,$location,$scope,Authentication,Organization){function activate(){vm.account={},vm.authMsg="",vm.login=function(){vm.authMsg="",vm.loginForm.$valid?$http.post("api/account/login",{email:vm.account.email,password:vm.account.password}).then(function(response){response.data.account?($scope.authentication.user=response.data.account,Organization.getSelectedOrganization().then(function(){Organization.getOrganizations().then(function(){$state.go("app.dashboard")})})):vm.authMsg="Incorrect credentials"},function(reason){console.log(reason),"401"==reason.status?vm.authMsg="Incorrect credentials":vm.authMsg="Server Request Error",$state.go("page.login")}):(vm.loginForm.account_email.$dirty=!0,vm.loginForm.account_password.$dirty=!0)}}var vm=this;$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/dashboard"),activate()}angular.module("biinUsers").controller("LoginFormController",LoginFormController),LoginFormController.$inject=["$http","$state","$location","$scope","Authentication","Organization"]}(),angular.module("biins").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.biins",{url:"/biins",templateUrl:"modules/biins/views/biins.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function BiinModalController($scope,$modalInstance,selectedObj,elements,showcases){if($scope.type=selectedObj.type,$scope.elements=elements,$scope.showcases=showcases,$scope.timeEnabled=[0,24],"create"===$scope.type){var obj={objectType:"1",notification:"",hasNotification:"0",isNew:!0},time=moment();time.minutes(0),time.hours(0),obj.onMonday="1",obj.onTuesday="1",obj.onWednesday="1",obj.onThursday="1",obj.onFriday="1",obj.onSaturday="1",obj.onSunday="1",obj.startTime=time.format(),obj.endTime=time.format(),$scope.obj=obj}else $scope.obj=selectedObj.obj,$scope.timeEnabled=[Number($scope.obj.startTime),Number($scope.obj.endTime)];$scope.hasNotificationBool=!1,$scope.hasTimeOptionsBool=!1,$scope.mondayBool=!1,$scope.tuesdayBool=!1,$scope.wednesdayBool=!1,$scope.thursdayBool=!1,$scope.fridayBool=!1,$scope.saturdayBool=!1,$scope.sundayBool=!1,$scope.hasNotificationBool="1"===$scope.obj.hasNotification,$scope.hasTimeOptionsBool="1"===$scope.obj.hasTimeOptions,$scope.mondayBool="1"===$scope.obj.onMonday,$scope.tuesdayBool="1"===$scope.obj.onTuesday,$scope.wednesdayBool="1"===$scope.obj.onWednesday,$scope.thursdayBool="1"===$scope.obj.onThursday,$scope.fridayBool="1"===$scope.obj.onFriday,$scope.saturdayBool="1"===$scope.obj.onSaturday,$scope.sundayBool="1"===$scope.obj.onSunday,$scope.changeObjectType=function(selected){setTimeout(function(){$scope.$apply(function(){$scope.obj.identifier=""})},100)},$scope.changeNotificationState=function(){$scope.obj.hasNotification=$scope.hasNotificationBool?"1":"0"},$scope.changeTimeOptionsState=function(){$scope.obj.hasTimeOptions=$scope.hasTimeOptionsBool?"1":"0"},$scope.changeDayState=function(varName,boolVarName){$scope.obj[varName]=$scope[boolVarName]?"1":"0"},$scope.save=function(){"1"==$scope.obj.hasTimeOptions?($scope.obj.startTime=$scope.timeEnabled[0]+"",$scope.obj.endTime=$scope.timeEnabled[1]+""):($scope.obj.startTime="0",$scope.obj.endTime="24"),$modalInstance.close($scope.obj)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.validatesValues=function(value,event){value&&Array.isArray(value)&&(value[1]-value[0]<=.5&&24==value[1]?$scope.timeEnabled=[23.5,24]:value[1]-value[0]<.5&&($scope.timeEnabled=[value[0],value[0]+.5]))}}angular.module("biins").controller("biinsModalController",BiinModalController),BiinModalController.$inject=["$scope","$modalInstance","selectedObj","elements","showcases"]}(),function(){function BiinsController($http,$state,$scope,$modal,Authentication,Organization,ObjectsSidebar,Loading){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization}$scope.objectsSidebarService=ObjectsSidebar,$scope.objectsSidebarService.enableAddButton=!1,$scope.getSiteName=function(identifier){var site=_.findWhere($scope.sites,{identifier:identifier});return site?site.title1+" "+site.title2:""},$scope.getObjectName=function(identifier,type){if(identifier&&type)if("1"===type){var el=_.findWhere($scope.elements,{elementIdentifier:identifier});if(el)return el.title}else{var sh=_.findWhere($scope.showcases,{identifier:identifier});if(sh)return sh.name}return"name not available"},$scope.removeObject=function(index){$scope.objectsSidebarService.selectedObject.objects.splice(index,1),$scope.biins=$scope.objectsSidebarService.getObjects()},$scope.save=function(){null!=$scope.objectsSidebarService.selectedObject&&$http.put(ApplicationConfiguration.applicationBackendURL+"api/venues/create",null,{headers:{name:$scope.objectsSidebarService.selectedObject.venue,orgidentifier:$scope.organizationId}}).success(function(){$http.post(ApplicationConfiguration.applicationBackendURL+"api/biins/"+$scope.objectsSidebarService.selectedObject.identifier+"/update",$scope.objectsSidebarService.selectedObject).success(function(){console.log("success")}).error(function(err){console.log(err)})})};activate(),$scope.objectsSidebarService=ObjectsSidebar,$scope.sidebarTemplate="<div class='col-md-12 leftInformationArea' style='padding-left: 10px'><label class='threeRowTitle'>{{item.name}}</label><localization class='threeRowSubTitle' style='display: block'></localization><p class='threeRowThirdLine'>{{item.status}}</p></div>",$scope.objectsSidebarService.template=$scope.sidebarTemplate,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.$on("organizationChanged",function(){$scope.objectsSidebarService.selectedObject=null,$scope.objectsSidebarService.objects=[],$scope.loadingService.isLoading=!0,$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/sites/").success(function(data){$scope.sites=data.data.sites,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/readyElementser/").success(function(data){$scope.elements=data.data.elements,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/showcases/").success(function(data){$scope.showcases=data.data,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/biins/").success(function(data){$scope.biins=data.data,$scope.objectsSidebarService.setObjects(data.data),$scope.loadingService.isLoading=!1}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}),$scope.$on("Biin: On Object Clicked",function(event,objectClicked){}),$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/sites/").success(function(data){$scope.sites=data.data.sites,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/readyElements/").success(function(data){$scope.elements=data.data.elements,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/showcases/").success(function(data){$scope.showcases=data.data,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/biins/").success(function(data){$scope.biins=data.data,$scope.objectsSidebarService.setObjects(data.data),$scope.loadingService.isLoading=!1}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)})}).error(function(err){console.log(err)}),$scope.saveObject=function(obj){obj&&"isNew"in obj&&(delete obj.isNew,$scope.objectsSidebarService.selectedObject.objects.push(obj),$scope.biins=$scope.objectsSidebarService.getObjects())},$scope.getVenues=function(val){return $http.get(ApplicationConfiguration.applicationBackendURL+"api/venues/search",{headers:{regex:val,orgidentifier:$scope.organizationId}}).then(function(response){return response.data})},$scope.convertTime=function(time){var hours=parseInt(time),min=60*(parseFloat(time)-hours),hoursString=10>hours?"0"+hours:""+hours,minString=10>min?"0"+min:""+min;return hoursString+":"+minString},$scope.biinObject=function(size,type,obj){var modalInstance=$modal.open({templateUrl:"/modules/biins/views/partials/biin.client.modal.view.html",controller:"biinsModalController",size:size,resolve:{selectedObj:function(){return"create"===type?{type:type}:{type:type,obj:obj}},elements:function(){return $scope.elements},showcases:function(){return $scope.showcases}}});modalInstance.result.then(function(objectToCreate){$scope.saveObject(objectToCreate)},function(){})}}angular.module("biins").controller("BiinsController",BiinsController),BiinsController.$inject=["$http","$state","$scope","$modal","Authentication","Organization","ObjectsSidebar","Loading"]}(),function(){function organizationDropDown($http,Organization){function link(scope,element,attrs){scope.organzationService=Organization,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+scope.organzationService.selectedOrganization.identifier+"/sites/").success(function(data){scope.sites=data.data.sites,scope.getSiteName=function(identifier){var site=_.findWhere(scope.sites,{identifier:identifier});return site?site.title1+" "+site.title2:""},scope.$on("organizationChanged",function(){$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+scope.organzationService.selectedOrganization.identifier+"/sites/").success(function(data){scope.sites=data.data.sites})})})}var directive={link:link,restrict:"E",template:"<text>{{getSiteName(item.siteIdentifier)}}</text>",transclude:!1};return directive}angular.module("biins").directive("localization",organizationDropDown),organizationDropDown.$inject=["$http","Organization"]}(),function(){angular.module("app.colors").constant("APP_COLORS",{primary:"#5d9cec",success:"#27c24c",info:"#23b7e5",warning:"#ff902b",danger:"#f05050",inverse:"#131e26",green:"#37bc9b",pink:"#f532e5",purple:"#7266ba",dark:"#3a3f51",yellow:"#fad732","gray-darker":"#232735","gray-dark":"#3a3f51",gray:"#dde6e9","gray-light":"#e4eaec","gray-lighter":"#edf1f2"})}(),function(){function Colors(APP_COLORS){function byName(name){return APP_COLORS[name]||"#fff"}this.byName=byName}angular.module("app.colors").service("Colors",Colors),Colors.$inject=["APP_COLORS"]}(),function(){function coreConfig($controllerProvider,$compileProvider,$filterProvider,$provide){var core=angular.module("app.core");core.controller=$controllerProvider.register,core.directive=$compileProvider.directive,core.filter=$filterProvider.register,core.factory=$provide.factory,core.service=$provide.service,core.constant=$provide.constant,core.value=$provide.value}angular.module("app.core").config(coreConfig),coreConfig.$inject=["$controllerProvider","$compileProvider","$filterProvider","$provide"]}(),function(){angular.module("app.core").constant("APP_MEDIAQUERY",{desktopLG:1200,desktop:992,tablet:768,mobile:480})}(),function(){function coreMenu(Menus){Menus.addMenuItem("sidebar","Dashboard","dashboard",null,"/dashboard",!1,null,null,"icon-speedometer","sidebar.MENU_DASHBOARD"),Menus.addMenuItem("sidebar","Sites","sites",null,"/sites",!1,null,null,"icon-pointer","sidebar.MENU_SITES"),Menus.addMenuItem("sidebar","Elements","elements",null,"/elements",!1,null,null,"icon-book-open","sidebar.MENU_ELEMENTS"),Menus.addMenuItem("sidebar","Showcase","showcases",null,"/showcase",!1,null,null,"icon-docs","sidebar.MENU_SHOWCASES"),Menus.addMenuItem("sidebar","Biins","biins",null,"/biins",!1,null,null,"icon-feed","sidebar.MENU_BIINS"),Menus.addMenuItem("sidebar","NPS","nps",null,null,!1,null,null,"fa fa-bar-chart","sidebar.MENU_NPS"),Menus.addMenuItem("sidebar","Administration","profile","dropdown",null,!1,null,null,"fa fa-gears","sidebar.MENU_ADMINISTRATION"),Menus.addSubMenuItem("sidebar","profile","Profile","profile","/profile",!1,null,null,"sidebar.MENU_PROFILE"),Menus.addSubMenuItem("sidebar","profile","Organizations","organization","/organization",!1,null,null,"sidebar.MENU_ORGANIZATIONS"),Menus.addMenuItem("sidebar","Maintenance","maintenance",null,"/maintenance",!1,"maintenance",null,"icon-settings","sidebar.MENU_MAINTENANCE")}angular.module("app.core").run(coreMenu),coreMenu.$inject=["Menus"]}(),function(){function appRoutes($stateProvider,$locationProvider,$urlRouterProvider,helper){$locationProvider.html5Mode(!1),$urlRouterProvider.otherwise("/page/login"),$stateProvider.state("app",{"abstract":!0,templateUrl:"modules/core/views/core.client.view.html",resolve:helper.resolveFor("modernizr","icons","filestyle")}).state("app.home",{templateUrl:"modules/core/views/home.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}}).state("appleftbar",{"abstract":!0,templateUrl:"modules/core/views/coreleftbar.client.view.html",resolve:helper.resolveFor("modernizr","icons","filestyle")})}angular.module("app.core").config(appRoutes),appRoutes.$inject=["$stateProvider","$locationProvider","$urlRouterProvider","RouteHelpersProvider"]}(),function(){function appRun($rootScope,$state,$stateParams,$window,$templateCache,Colors){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$storage=$window.localStorage,$rootScope.colorByName=Colors.byName,$rootScope.cancel=function($event){$event.stopPropagation()},$rootScope.$on("$stateNotFound",function(event,unfoundState){console.log(unfoundState.to),console.log(unfoundState.toParams),console.log(unfoundState.options)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){console.log(error)}),$rootScope.$on("$stateChangeSuccess",function(){$window.scrollTo(0,0),$rootScope.currTitle=$state.current.title}),$rootScope.currTitle=$state.current.title,$rootScope.pageTitle=function(){var title=$rootScope.app.name+" - "+($rootScope.currTitle||$rootScope.app.description);return document.title=title,title}}angular.module("app.core").run(appRun),appRun.$inject=["$rootScope","$state","$stateParams","$window","$templateCache","Colors"]}(),angular.module("app.core").controller("HeaderController",["$scope","Authentication","Menus","Organization",function($scope,Authentication,Menus,Organization){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.organizationService=Organization,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("app.core").controller("LoadingController",["$scope","Loading",function($scope,LoadingService){$scope.loading=LoadingService}]),angular.module("app.core").service("Categories",["$http",function(async){return{getList:function(){var promise=async({method:"GET",url:ApplicationConfiguration.applicationBackendURL+"api/categories"}).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return{status:!1}});return promise}}}]),angular.module("app.core").service("Loading",[function(){return{isLoading:!1}}]),angular.module("app.core").service("Menus",[function(){this.menus={},this.defaultRoles=["*"];var shouldRender=function(user){if(user){if(~this.roles.indexOf("*"))return!0;for(var index in user.permissions){var attr=user.permissions[index];if(attr.permission===this.roles)return!0}return!1}return this.isPublic};this.userHasValidPermit=function(roles){return null===roles||"undefined"==typeof roles?!0:user.role===roles?!0:!1},this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position,iconClass,translateKey,alert){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender,iconClass:iconClass||"fa fa-file-o",translate:translateKey,alert:alert}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position,translateKey){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender,translate:translateKey});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar"),this.addMenu("sidebar")}]),angular.module("app.core").service("Organization",["$http","$q","$rootScope","Authentication","GlobalFilters",function($http,$q,$rootScope,Authentication,GlobalFilters){
var deferObject,service={selectedOrganization:"undefined",selectedOrganizationId:"undefined",organizationsList:[],getSelectedOrganization:function(){if(Authentication.user){var promise=$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+Authentication.user.accountIdentifier+"/selectedOrganization/");return deferObject=deferObject||$q.defer(),promise.then(function(result){service.selectedOrganizationId=result.data.data.selectedOrganization,deferObject.resolve(result)},function(reason){deferObject.reject(reason)}),deferObject.promise}},getOrganizations:function(){if(Authentication.user){var promise=$http.get("/api/organization");return deferObject=deferObject||$q.defer(),promise.then(function(result){service.organizationsList=result.data.data;for(var orgIndex=0;orgIndex<service.organizationsList.length;orgIndex++){for(var siteList=[],siteIndex=0;siteIndex<service.organizationsList[orgIndex].sites.length;siteIndex++)0==service.organizationsList[orgIndex].sites[siteIndex].isDeleted&&siteList.push(service.organizationsList[orgIndex].sites[siteIndex]);service.organizationsList[orgIndex].sites=siteList}if(service.selectedOrganization=service.organizationsList[0],"undefined"!=service.selectedOrganizationId)for(var orgFound=!1,index=0;!orgFound&&index<service.organizationsList.length;)service.organizationsList[index].identifier==service.selectedOrganizationId&&(service.selectedOrganization=service.organizationsList[index],orgFound=!0),index++;GlobalFilters.setDefaultSite(service.selectedOrganization.sites[0]),deferObject.resolve(result)},function(reason){deferObject.reject(reason)}),deferObject.promise}},setSelectedOrganization:function(index){Authentication.user&&index>=0&&index<this.organizationsList.length&&(this.selectedOrganization=this.organizationsList[index],this.selectedOrganizationId=this.selectedOrganization.identifier,GlobalFilters.setDefaultSite(service.selectedOrganization.sites[0]),$http.put(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+Authentication.user.accountIdentifier+"/"+service.selectedOrganization.identifier,{}),$rootScope.$broadcast("organizationChanged"),$rootScope.$broadcast("changeSelectedSite"))},removeOrganization:function(id){for(var i=0;i<this.organizationsList.length;i++)if(this.organizationsList[i].identifier==id){this.organizationsList.slice(i,1);break}service.setSelectedOrganization(0)}};return service}]),angular.module("app.core").service("Permission",["$http","$q","Authentication",function($http,$q,Authentication){var deferObject,service={getPermissions:function(){if(Authentication.user){var promise=$http.get(ApplicationConfiguration.applicationBackendURL+"roles/"+Authentication.user.role+"/getpermission");return deferObject=deferObject||$q.defer(),promise.then(function(result){Authentication.user.permissions=result.data.data,deferObject.resolve(result)},function(reason){deferObject.reject(reason)}),deferObject.promise}}};return service}]),angular.module("dashboard").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.dashboard",{url:"/dashboard",templateUrl:"modules/dashboard/views/dashboard.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function DashboardController($http,$state,$scope,Authentication,Organization,ObjectsSidebar,GlobalFilters,Loading){function activate(){$scope.globalFilters.dateRange=30}$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters,$scope.objectsSidebar=ObjectsSidebar,$scope.objectsSidebar.isHidden=!0,$scope.loadingService=Loading,$scope.loadingService.isLoading=!1,activate(),$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.changeChartRange=function(numberDays){$scope.globalFilters.changeDateRange(numberDays)},$scope.changeSelectedSite=function(){$scope.globalFilters.changeSelectedSite($scope.globalFilters.selectedSite)},$scope.$on("organizationChanged",function(){$scope.globalFilters.selectedSite=$scope.organizationService.selectedOrganization.sites[0],$scope.globalFilters.changeSelectedSite($scope.organizationService.selectedOrganization.sites[0])})}angular.module("dashboard").controller("DashboardController",DashboardController),DashboardController.$inject=["$http","$state","$scope","Authentication","Organization","ObjectsSidebar","GlobalFilters","Loading"]}(),function(){function mobileTotalBiinedController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}$scope.value=0,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.getChartData=function(days){var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/mobile/totalbiined",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){$scope.value=data.data})},$scope.changeChartRange=function(days){$scope.getChartData(days)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("mobileTotalBiinedController",mobileTotalBiinedController),mobileTotalBiinedController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),function(){function mobileAverageVisitedElementsController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}$scope.value=0,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.getChartData=function(days){var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/mobile/visitedelements",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){$scope.value=data.data})},$scope.changeChartRange=function(days){$scope.getChartData(days)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("mobileAverageVisitedElementsController",mobileAverageVisitedElementsController),mobileAverageVisitedElementsController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),function(){function mobileNewVisitsPercentageController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}$scope.value=0,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.getChartData=function(days){var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/mobile/newvisits",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){$scope.value=data.data})},$scope.changeChartRange=function(days){$scope.getChartData(days)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("mobileNewVisitsPercentageController",mobileNewVisitsPercentageController),mobileNewVisitsPercentageController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),function(){function mobileSessionsController($http,$state,$scope,Authentication,Organization){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization}$scope.value=0,$scope.currentDays=0,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.currentDays)}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.currentDays)}),$scope.getChartData=function(days){var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/mobile/sessions",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){$scope.value=data.data})},$scope.changeChartRange=function(days){$scope.getChartData(days),$scope.currentDays=days},$scope.changeChartRange(30)}angular.module("dashboard").controller("mobileSessionsController",mobileSessionsController),mobileSessionsController.$inject=["$http","$state","$scope","Authentication","Organization"]}(),function(){function mobilePieVisitsController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}$scope.value=0,$scope.enoughData=!1,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.options={chart:{type:"pieChart",x:function(d){return d.key},y:function(d){return d.y},showLabels:!0,transitionDuration:500,labelThreshold:.01,legend:{margin:{top:5,right:35,bottom:5,left:0}}}},$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.getChartData=function(days){var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/mobile/newsvsreturning",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){var information=data.data;$scope.enoughData=information.news||information.returning,$scope.enoughData&&($scope.data=[{key:"New Visits",y:information.news},{key:"Frecuent Client",y:information.returning}])})},$scope.changeChartRange=function(days){$scope.getChartData(days)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("mobilePieVisitsController",mobilePieVisitsController),mobilePieVisitsController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),function(){function siteNewVisitsPercentageController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}$scope.value=0,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData()}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.$on("Biin: Site Changed",function(){$scope.getChartData()}),$scope.getChartData=function(){var filters={};filters.siteId=$scope.globalFilters.selectedSite.identifier,filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/local/newvisits",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){$scope.value=data.data})},$scope.changeChartRange=function(days){$scope.getChartData(days)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("siteNewVisitsPercentageController",siteNewVisitsPercentageController),siteNewVisitsPercentageController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),function(){function siteSessionsController($http,$state,$scope,Authentication,Organization){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization}$scope.value=0,$scope.currentDays=0,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.currentDays)}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange(numberdays)}),$scope.$on("Biin: Site Changed",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.getChartData=function(days){var filters={};filters.siteId=$scope.globalFilters.selectedSite.identifier,filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/local/sessions",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){$scope.value=data.data})},$scope.changeChartRange=function(days){$scope.getChartData(days),$scope.currentDays=days},$scope.changeChartRange(30)}angular.module("dashboard").controller("siteSessionsController",siteSessionsController),siteSessionsController.$inject=["$http","$state","$scope","Authentication","Organization"]}(),function(){function sitesPieVisitsController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}$scope.value=0,$scope.enoughData=!1,activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.options={chart:{type:"pieChart",x:function(d){return d.key},y:function(d){return d.y},showLabels:!0,transitionDuration:500,labelThreshold:.01,legend:{margin:{top:5,right:35,bottom:5,left:0}}}},$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.$on("Biin: Site Changed",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.getChartData=function(days){var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,filters.siteId=$scope.globalFilters.selectedSite.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/local/newsvsreturning",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){var information=data.data;$scope.enoughData=information.news||information.returning,$scope.enoughData&&($scope.data=[{key:"New Visits",y:information.news},{key:"Frecuent Client",y:information.returning}])})},$scope.changeChartRange=function(days){$scope.getChartData(days)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("sitesPieVisitsController",sitesPieVisitsController),sitesPieVisitsController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),function(){function VisitsGraphController($http,$state,$scope,Authentication,Organization,GlobalFilters){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.globalFilters=GlobalFilters}activate(),$scope.$on("organizationChanged",function(){$scope.getChartData($scope.globalFilters.dateRange)}),$scope.$on("Biin: Days Range Changed",function(scope,numberdays){$scope.changeChartRange($scope.globalFilters.dateRange)}),$scope.secondCriteriaChange=function(value){$scope.getChartData($scope.globalFilters.dateRange)},$scope.firstCriteriaChange=function(value){$scope.getChartData($scope.globalFilters.dateRange)},$scope.getChartData=function(days){var today=new Date,previusDate=new Date;previusDate.setTime(today.getTime()-864e5*days);var filters={};filters.organizationId=$scope.organizationService.selectedOrganization.identifier,filters.dateRange=$scope.globalFilters.dateRange,filters.siteId=$scope.globalFilters.selectedSite.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/notifications",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(dataNotifications){$http.get(ApplicationConfiguration.applicationBackendURL+"api/dashboard/visits",{headers:{filters:JSON.stringify(filters),offset:(new Date).getTimezoneOffset()}}).success(function(data){for(var visits=[],notifications=[],keys=Object.keys(data),maxValue=1,i=0;i<keys.length;i++){var s=new Date(keys[i]);visits.push({x:s.getTime(),y:data[keys[i]]}),notifications.push({x:s.getTime(),y:dataNotifications[keys[i]]}),data[keys[i]]>maxValue&&(maxValue=data[keys[i]])}$scope.data=[{values:visits,key:"visits",color:"#006699",area:!0},{values:notifications,key:"Notifications",color:"#ffa500",area:!0}],$scope.options={chart:{type:"lineChart",height:250,margin:{top:20,right:20,bottom:40,left:55},x:function(d){return d.x},y:function(d){return d.y},xAxis:{axisLabel:"Date",tickFormat:function(d){return d3.time.format("%d-%m-%y")(new Date(d))},showMaxMin:!1,axisLabelDistance:30},yAxis:{},callback:function(chart){},forceY:[0,maxValue]}}})})},$scope.changeChartRange=function(days){$scope.getChartData($scope.globalFilters.dateRange)},$scope.changeChartRange($scope.globalFilters.dateRange)}angular.module("dashboard").controller("VisitsGraphController",VisitsGraphController),VisitsGraphController.$inject=["$http","$state","$scope","Authentication","Organization","GlobalFilters"]}(),angular.module("dashboard").service("GlobalFilters",["$http","$rootScope",function($http,$rootScope){var service={selectedSite:"undefined",dateRange:0,changeDateRange:function(numberDays){this.dateRange=numberDays,$rootScope.$broadcast("Biin: Days Range Changed",numberDays)},changeSelectedSite:function(newSite){this.selectedSite=newSite,$rootScope.$broadcast("Biin: Site Changed",newSite)},setDefaultSite:function(site){this.selectedSite=site}};return service}]),angular.module("elements").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.elements",{url:"/elements",templateUrl:"modules/elements/views/elements.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function ElementsController($http,$state,$timeout,$scope,Authentication,Organization,Categories,ObjectsSidebar,Gallery,Loading){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization}activate(),$scope.objectsSidebarService=ObjectsSidebar,$scope.sidebarTemplate="<div class='col-md-3 thumbListImage'><img ng-if='item.media.length == 0' src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjcwIiB5PSI3MCIgc3R5bGU9ImZpbGw6I2FhYTtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjE0MHgxNDA8L3RleHQ+PC9zdmc+' alt=''/><img ng-if='item.media.length>0' ng-src='{{item.media[0].url}}' pending-indicator='pending-indicator'/></div><div class='col-md-9 leftInformationArea'><label class='oneRowTitle'>{{item.title}}</label></div>",$scope.objectsSidebarService.template=$scope.sidebarTemplate,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.maxMedia=0,$scope.dragGalleryIndex=-1,$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$scope.newTagField=[],$scope.loadingImages=!1,$scope.hasListPriceBool=!1,$scope.hasDiscountBool=!1,$scope.hasTimmingBool=!1,$scope.hasQuantityBool=!1,$scope.hasSavingBool=!1,$scope.hasPriceBool=!1,$scope.hasFromPriceBool=!1,$scope.isHighlightBool=!1,$scope.galleries=[],$scope.$on("Biin: galleryUpdate",function(a,modalInfo){$scope.galleries=modalInfo.galleries}),$scope.$on("$stateChangeStart",function(){$scope.objectsSidebarService.reset(),$scope.objectsSidebarService.loadedInformation=!0}),$scope.$on("organizationChanged",function(){$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.selectedObject=null,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/elements").success(function(data){$scope.elements=data.data.elements,$scope.objectsSidebarService.setObjects($scope.elements),$scope.loadingService.isLoading=!1}),$scope.galleries=[],Gallery.getList($scope.organizationId).then(function(promise){$scope.galleries=promise.data.data})}),$scope.$on("Biin: On Object Clicked",function(f,objectClicked){$timeout(function(){var elemSearchTag=$("#elemSearchTag");elemSearchTag.tagsinput("removeAll");for(var i=0;i<$scope.objectsSidebarService.selectedObject.searchTags.length;i++)elemSearchTag.tagsinput("add",$scope.objectsSidebarService.selectedObject.searchTags[i])},100)}),$scope.$on("Biin: On Object Created",function(){$scope.create()}),$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/elements").success(function(data){$scope.elements=data.data.elements,$scope.objectsSidebarService.setObjects($scope.elements),$scope.loadingService.isLoading=!1}),$scope.create=function(){$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/elements").success(function(element,status){if(201==status){var elemSearchTag=$("#elemSearchTag");elemSearchTag.tagsinput("removeAll"),$scope.elements.push(element),$scope.objectsSidebarService.setObjects($scope.elements),$scope.objectsSidebarService.setSelectedObject(element)}else displayErrorMessage(element,"Element Creation",status)})},$scope.selectType=function(index){$scope.objectsSidebarService.selectedObject.elementType!==""+index?$scope.objectsSidebarService.selectedObject.elementType=""+index:$scope.objectsSidebarService.selectedObject.elementType="",$scope.validate(!0)},$scope.deleteElement=function(message,selectedObject){confirm(message)&&$scope.removeElementAt($scope.objectsSidebarService.objects.indexOf(selectedObject))},$scope.removeElementAt=function(index){$scope.objectsSidebarService.selectedObject==$scope.objectsSidebarService.objects[index]&&($scope.objectsSidebarService.selectedObject=null);var elementId=$scope.objectsSidebarService.objects[index].elementIdentifier;$http["delete"](ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/elements/"+elementId).success(function(data){$scope.objectsSidebarService.objects.splice(index,1)})},$scope.hasMissingData=function(){if(null!=$scope.objectsSidebarService.selectedObject){var missingMinData=!1;return null==$scope.objectsSidebarService.selectedObject.title?(missingMinData=!0,$scope.objectsSidebarService.selectedObject.title=""):""===$scope.objectsSidebarService.selectedObject.title.trim()&&(missingMinData=!0,$scope.objectsSidebarService.selectedObject.title=""),0===$scope.objectsSidebarService.selectedObject.media.length&&(missingMinData=!0),0===$scope.objectsSidebarService.selectedObject.categories.length&&(missingMinData=!0),null==$scope.objectsSidebarService.selectedObject.media?missingMinData=!0:0===$scope.objectsSidebarService.selectedObject.media.length&&(missingMinData=!0),missingMinData}},$scope.save=function(){if(null!=$scope.objectsSidebarService.selectedObject){if($scope.hasMissingData()?$scope.objectsSidebarService.selectedObject.isReady=0:$scope.objectsSidebarService.selectedObject.isReady=1,$scope.objectsSidebarService.selectedObject.callToActionTitle&&$scope.objectsSidebarService.selectedObject.callToActionURL){$scope.objectsSidebarService.selectedObject.hasCallToAction=!0;var httpRegex=/^http[s]?:\/\//;httpRegex.test($scope.objectsSidebarService.selectedObject.callToActionURL)||($scope.objectsSidebarService.selectedObject.callToActionURL="http://"+$scope.objectsSidebarService.selectedObject.callToActionURL)}else $scope.objectsSidebarService.selectedObject.hasCallToAction=!1;$scope.objectsSidebarService.selectedObject.isDeleted=0,$scope.objectsSidebarService.selectedObject.hasPrice=$scope.objectsSidebarService.selectedObject.price>0?"1":"0";var tags=$("#elemSearchTag").tagsinput("items");$scope.objectsSidebarService.selectedObject.searchTags=[];for(var i=0;i<tags.length;i++)$scope.objectsSidebarService.selectedObject.searchTags.push(tags[i]);$http.put(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/elements/"+$scope.objectsSidebarService.selectedObject.elementIdentifier,{model:$scope.objectsSidebarService.selectedObject}).success(function(data,status){"replaceModel"in data&&($scope.objectsSidebarService.selectedObject=data.replaceModel,$scope.elementPrototype=$.extend(!0,{},$scope.elementPrototypeBkp)),"success"==data.state&&($scope.succesSaveShow=!0)})}},Categories.getList().then(function(promise){$scope.categories=promise.data.data}),$scope.ownCategories=function(){var categories=[];return categories},$scope.setDragGallery=function(scopeIndex){$scope.dragGalleryIndex=scopeIndex},$scope.selectSticker=function(index){$scope.objectsSidebarService.selectedObject.sticker.identifier!==$scope.stickers[index].identifier?($scope.objectsSidebarService.selectedObject.sticker.identifier=$scope.stickers[index].identifier,$scope.objectsSidebarService.selectedObject.sticker.color=$scope.stickers[index].color):($scope.objectsSidebarService.selectedObject.sticker.identifier="",$scope.objectsSidebarService.selectedObject.sticker.color="")},$scope.insertGalleryItem=function(index){if($scope.objectsSidebarService.selectedObject.media.length<$scope.maxMedia&&index<$scope.galleries.length&&$scope.galleries[index]||0===$scope.maxMedia){var newObj={};newObj.identifier=$scope.galleries[index].identifier,newObj.url=$scope.galleries[index].url,newObj.mainColor=$scope.galleries[index].mainColor,$scope.objectsSidebarService.selectedObject.media.push(newObj),$scope.wizard2IsValid="undefined"!=typeof $scope.objectsSidebarService.selectedObject.media&&$scope.objectsSidebarService.selectedObject.media.length>0,$scope.$digest(),$scope.$apply()}},$scope.removeMediaAt=function(index){$scope.objectsSidebarService.selectedObject.media.length>=index&&$scope.objectsSidebarService.selectedObject.media.splice(index,1)},Gallery.getList($scope.organizationId).then(function(promise){$scope.galleries=promise.data.data}),$scope.onGalleryChange=function(obj,autoInsert){if($scope.galleries=$scope.galleries.concat(obj),$scope.$digest(),autoInsert)for(var cantToInsert=$scope.maxMedia-$scope.objectsSidebarService.selectedObject.media.length,i=0;cantToInsert>i;i++)$scope.insertGalleryItem($scope.galleries.indexOf(obj[i]))},$scope.loadingImagesChange=function(state){$scope.loadingImages=state,$scope.$digest()},$scope.containsCategory=function(category){return"undefined"!=typeof _.findWhere($scope.objectsSidebarService.selectedObject.categories,{identifier:category.identifier})?!0:!1},$scope.updateSelectedCategories=function(category){var index=-1,cat=_.findWhere($scope.objectsSidebarService.selectedObject.categories,{identifier:category.identifier});"undefined"!=typeof cat&&(index=$scope.objectsSidebarService.selectedObject.categories.indexOf(cat)),index>=0?$scope.objectsSidebarService.selectedObject.categories.splice(index,1):$scope.objectsSidebarService.selectedObject.categories.push(category)}}angular.module("elements").controller("ElementsController",ElementsController),ElementsController.$inject=["$http","$state","$timeout","$scope","Authentication","Organization","Categories","ObjectsSidebar","Gallery","Loading"]}(),function(){function ImageCropController($scope){function activate(){vm.reset=function(){vm.myImage="",vm.myCroppedImage="",vm.imgcropType="square"},vm.reset();var handleFileSelect=function(evt){var file=evt.currentTarget.files[0],reader=new FileReader;reader.onload=function(evt){$scope.$apply(function(){vm.myImage=evt.target.result})},file&&reader.readAsDataURL(file)};angular.element(document.querySelector("#fileInput")).on("change",handleFileSelect)}var vm=this;activate()}angular.module("app.forms").controller("ImageCropController",ImageCropController),ImageCropController.$inject=["$scope"]}(),function(){function FormValidationController(){function activate(){vm.notBlackListed=function(value){var blacklist=["some@mail.com","another@email.com"];return-1===blacklist.indexOf(value)},vm.words=function(value){return value&&value.split(" ").length},vm.submitted=!1,vm.validateInput=function(name,type){var input=vm.formValidate[name];return(input.$dirty||vm.submitted)&&input.$error[type]},vm.submitForm=function(){return vm.submitted=!0,vm.formValidate.$valid?void console.log("Submitted!!"):(console.log("Not valid!!"),!1)}}var vm=this;activate()}angular.module("app.forms").controller("FormValidationController",FormValidationController)}(),function(){function FormxEditableController($scope,editableOptions,editableThemes,$filter,$http){function activate(){editableOptions.theme="bs3",editableThemes.bs3.inputClass="input-sm",editableThemes.bs3.buttonsClass="btn-sm",editableThemes.bs3.submitTpl='<button type="submit" class="btn btn-success"><span class="fa fa-check"></span></button>',editableThemes.bs3.cancelTpl='<button type="button" class="btn btn-default" ng-click="$form.$cancel()"><span class="fa fa-times text-muted"></span></button>',vm.user={email:"email@example.com",tel:"123-45-67",number:29,range:10,url:"http://example.com",search:"blabla",color:"#6a4415",date:null,time:new Date,datetime:null,month:null,week:null,desc:"Sed pharetra euismod dolor, id feugiat ante volutpat eget. "},vm.user2={status:2},vm.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"},{value:4,text:"status4"}],vm.showStatus=function(){var selected=$filter("filter")(vm.statuses,{value:vm.user2.status});return vm.user2.status&&selected.length?selected[0].text:"Not set"},vm.user3={id:4,text:"admin"},vm.groups=[],vm.loadGroups=function(){return vm.groups.length?null:$http.get("server/xeditable-groups.json").success(function(data){vm.groups=data})},$scope.$watch("user3.id",function(newVal,oldVal){if(newVal!==oldVal){var selected=$filter("filter")(vm.groups,{id:vm.user3.id});vm.user3.text=selected.length?selected[0].text:null}}),vm.user4={state:"Arizona"},vm.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]}var vm=this;vm.title="Controller",activate()}angular.module("app.forms").controller("FormxEditableController",FormxEditableController),FormxEditableController.$inject=["$scope","editableOptions","editableThemes","$filter","$http"]}(),function(){
function FormDemoCtrl($resource){function activate(){var actions={get:{method:"GET",isArray:!0}},Cities=$resource("server/cities.json",{},actions);Cities.get(function(data){vm.cities=data}),vm.slider1=5,vm.slider2=10,vm.slider3=15,vm.slider4=20,vm.slider5=25,vm.slider6=30,vm.slider7=10,vm.slider8=[250,750];var States=$resource("server/chosen-states.json",{},{query:{method:"GET",isArray:!0}});vm.states=States.query(),vm.alertSubmit=function(){return alert("Form submitted!"),!1},vm.wysiwygContent="<p> Write something here.. </p>",vm.htmlContent='<h2>Try me!</h2><p>textAngular is a super cool WYSIWYG Text Editor directive for AngularJS</p><p><b>Features:</b></p><ol><li>Automatic Seamless Two-Way-Binding</li><li style="color: blue;">Super Easy <b>Theming</b> Options</li><li>Simple Editor Instance Creation</li><li>Safely Parses Html for Custom Toolbar Icons</li><li>Doesn&apos;t Use an iFrame</li><li>Works with Firefox, Chrome, and IE8+</li></ol><p><a href="https://github.com/fraywing/textAngular">Source</a> </p>'}var vm=this;activate()}angular.module("app.forms").controller("FormDemoCtrl",FormDemoCtrl),FormDemoCtrl.$inject=["$resource"]}(),function(){function uiSelectController($scope,$http){function activate(){vm.disabled=void 0,vm.enable=function(){vm.disabled=!1},vm.disable=function(){vm.disabled=!0},vm.clear=function(){vm.person.selected=void 0,vm.address.selected=void 0,vm.country.selected=void 0},vm.person={},vm.people=[{name:"Adam",email:"adam@email.com",age:10},{name:"Amalie",email:"amalie@email.com",age:12},{name:"Wladimir",email:"wladimir@email.com",age:30},{name:"Samantha",email:"samantha@email.com",age:31},{name:"Estefanía",email:"estefanía@email.com",age:16},{name:"Natasha",email:"natasha@email.com",age:54},{name:"Nicole",email:"nicole@email.com",age:43},{name:"Adrian",email:"adrian@email.com",age:21}],vm.address={},vm.refreshAddresses=function(address){var params={address:address,sensor:!1};return $http.get("http://maps.googleapis.com/maps/api/geocode/json",{params:params}).then(function(response){vm.addresses=response.data.results})},vm.country={},vm.countries=[{name:"Afghanistan",code:"AF"},{name:"Åland Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Congo, The Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea, Democratic People's Republic of",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia and Montenegro",code:"CS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan, Province of China",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor-Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Vietnam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}],vm.someGroupFn=function(item){return item.name[0]>="A"&&item.name[0]<="M"?"From A - M":item.name[0]>="N"&&item.name[0]<="Z"?"From N - Z":void 0},vm.counter=0,vm.someFunction=function(item,model){vm.counter++,vm.eventResult={item:item,model:model}},vm.availableColors=["Red","Green","Blue","Yellow","Magenta","Maroon","Umbra","Turquoise"],vm.multipleDemo={},vm.multipleDemo.colors=["Blue","Red"],vm.multipleDemo.selectedPeople=[vm.people[5],vm.people[4]],vm.multipleDemo.selectedPeopleWithGroupBy=[vm.people[8],vm.people[6]],vm.multipleDemo.selectedPeopleSimple=["samantha@email.com","wladimir@email.com"]}var vm=this;activate()}angular.module("app.forms").controller("uiSelectController",uiSelectController),uiSelectController.$inject=["$scope","$http"]}(),function(){function FileUploadController(FileUploader){function activate(){var uploader=vm.uploader=new FileUploader({url:"server/upload.php"});uploader.filters.push({name:"customFilter",fn:function(){return this.queue.length<10}}),uploader.onWhenAddingFileFailed=function(item,filter,options){console.info("onWhenAddingFileFailed",item,filter,options)},uploader.onAfterAddingFile=function(fileItem){console.info("onAfterAddingFile",fileItem)},uploader.onAfterAddingAll=function(addedFileItems){console.info("onAfterAddingAll",addedFileItems)},uploader.onBeforeUploadItem=function(item){console.info("onBeforeUploadItem",item)},uploader.onProgressItem=function(fileItem,progress){console.info("onProgressItem",fileItem,progress)},uploader.onProgressAll=function(progress){console.info("onProgressAll",progress)},uploader.onSuccessItem=function(fileItem,response,status,headers){console.info("onSuccessItem",fileItem,response,status,headers)},uploader.onErrorItem=function(fileItem,response,status,headers){console.info("onErrorItem",fileItem,response,status,headers)},uploader.onCancelItem=function(fileItem,response,status,headers){console.info("onCancelItem",fileItem,response,status,headers)},uploader.onCompleteItem=function(fileItem,response,status,headers){console.info("onCompleteItem",fileItem,response,status,headers)},uploader.onCompleteAll=function(){console.info("onCompleteAll")},console.info("uploader",uploader)}var vm=this;activate()}angular.module("app.forms").controller("FileUploadController",FileUploadController),FileUploadController.$inject=["FileUploader"]}(),function(){function filestyle(){function link(scope,element){var options=element.data();options.classInput=element.data("classinput")||options.classInput,element.filestyle(options)}var directive={link:link,restrict:"A"};return directive}angular.module("app.forms").directive("filestyle",filestyle)}(),function(){function formWizard($parse){function link(scope,element,attrs){var validate=$parse(attrs.validateSteps)(scope),wiz=new Wizard(attrs.steps,!!validate,element);scope.wizard=wiz.init()}function Wizard(quantity,validate,element){var self=this;self.quantity=parseInt(quantity,10),self.validate=validate,self.element=element,self.init=function(){return self.createsteps(self.quantity),self.go(1),self},self.go=function(step){if(angular.isDefined(self.steps[step])){if(self.validate&&1!==step){var form=$(self.element),group=form.children().children("div").get(step-2);if(!1===form.parsley().validate(group.id))return!1}self.cleanall(),self.steps[step]=!0}},self.active=function(step){return!!self.steps[step]},self.cleanall=function(){for(var i in self.steps)self.steps[i]=!1},self.createsteps=function(q){self.steps=[];for(var i=1;q>=i;i++)self.steps[i]=!1}}var directive={link:link,restrict:"A",scope:!0};return directive}angular.module("app.forms").directive("formWizard",formWizard),formWizard.$inject=["$parse"]}(),function(){function masked(){function link(scope,element){var $elem=$(element);$.fn.inputmask&&$elem.inputmask()}var directive={link:link,restrict:"A"};return directive}angular.module("app.forms").directive("masked",masked)}(),function(){function tagsinput($timeout){function link(scope,element,attrs,ngModel){element.on("itemAdded itemRemoved",function(){ngModel.$viewValue&&ngModel.$viewValue.split&&(ngModel.$setViewValue(ngModel.$viewValue.split(",")),ngModel.$render())}),$timeout(function(){element.tagsinput()})}var directive={link:link,require:"ngModel",restrict:"A"};return directive}angular.module("app.forms").directive("tagsinput",tagsinput),tagsinput.$inject=["$timeout"]}(),function(){function validateForm(){function link(scope,element){var $elem=$(element);$.fn.parsley&&$elem.parsley()}var directive={link:link,restrict:"A"};return directive}angular.module("app.forms").directive("validateForm",validateForm)}(),function(){function propsFilter(){function filterFilter(items,props){var out=[];return angular.isArray(items)?items.forEach(function(item){for(var itemMatches=!1,keys=Object.keys(props),i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)}):out=items,out}return filterFilter}angular.module("app.forms").filter("propsFilter",propsFilter)}(),angular.module("gallery").controller("GalleryController",GalleryController),GalleryController.$inject=["$scope","$modalInstance","$http","galleries","Organization"],function(){function Gallery($modal,ObjectsSidebar,$rootScope){function link(scope,element,attrs){scope.$watch("gallery",function(value){value&&(scope.galleries=value)}),scope.removeMediaAt=function(index){scope.$parent.removeMediaAt(index)},scope.showImageModal=function(){var mapInstance=$modal.open({scope:scope,templateUrl:"/modules/gallery/views/partials/gallery.modal.html",controller:"GalleryController",backdrop:"static",keyboard:!1,size:"lg",resolve:{loadingImages:function(){return scope.loadingImages},organizationId:function(){return scope.organizationId},galleries:function(){return scope.gallery}}});mapInstance.result.then(function(modalInfo){for(var i=0;i<modalInfo.selectedImages.length;i++){var newObj={};newObj.identifier=modalInfo.selectedImages[i].identifier,newObj.url=modalInfo.selectedImages[i].url,newObj.mainColor=modalInfo.selectedImages[i].mainColor,newObj.vibrantColor=modalInfo.selectedImages[i].vibrantColor,newObj.vibrantDarkColor=modalInfo.selectedImages[i].vibrantDarkColor,newObj.vibrantLightColor=modalInfo.selectedImages[i].vibrantLightColor,objectsSidebar.selectedObject.media.push(newObj)}$rootScope.$broadcast("Biin: galleryUpdate",modalInfo)},function(modalInfo){$rootScope.$broadcast("Biin: galleryUpdate",modalInfo)})}}var objectsSidebar=ObjectsSidebar,directive={link:link,restrict:"E",scope:{media:"=ngModel",gallery:"="},template:'<div class="row"><div scrollbar="scrollbarOptionsStandard" class="ownedGalleryWrapper scrollbar-inner"><div ng-repeat="item in media" class="img-block" data-drop="true"  jqyoui-droppable="{index:{{$index}}}" data-drag="true" data-jqyoui-options="{revert: \'invalid\',zIndex: 100}" jqyoui-draggable="{insertInline:true, index:{{$index}}}" ng-model="media"><div class="moduleWrapper img-block-buttons"><img ng-src="{{item.url}}" pending-indicator="pending-indicator" class="imagegallery img-responsive"/><div ng-click="removeMediaAt(media.indexOf(item))" class="btnShowcasePreview icon-round-control btnDelete btn-danger btn-on-hover"><i class="fa fa-trash fa-2x"></i></div></div></div><div class="img-add-block"><div  ng-click="showImageModal()" class="btn-default img-add-block-wrapper dottedBorder"><span translate="GENERIC.ADD_IMAGE" class="btn-browse"></span></div></div></div></div>'};return directive}angular.module("gallery").directive("gallery",Gallery),Gallery.$inject=["$modal","ObjectsSidebar","$rootScope"]}(),function(){function ImageCheckbox(){return{restrict:"A",link:function(scope,el,attr){scope.isSelected="false"==el.find("input").val(),el.on("click",function(){scope.isSelected=!scope.isSelected,scope.$apply()})}}}angular.module("gallery").directive("imageCheckbox",ImageCheckbox),ImageCheckbox.$inject=["$modal"]}(),function(){function UploadFiles($modal,Organization,$rootScope){var organizationService=Organization;return{restrict:"A",link:function(scope,element,attrs){scope.uploadMedia=function(scope,formData,autoInsert){scope.loadingImagesChange(!0);var xhr=new XMLHttpRequest;xhr.open("POST",ApplicationConfiguration.applicationBackendURL+"api/organizations/"+organizationService.selectedOrganization.identifier+"/gallery"),xhr.onload=function(data){if(200===xhr.status){var obj=$.parseJSON(xhr.response);scope.onGalleryChange&&scope.onGalleryChange(obj,autoInsert),scope.loadingImagesChange(!1)}else console.log("Something went terribly wrong...")},xhr.upload.onprogress=function(event){if(event.lengthComputable){event.loaded/event.total*100|0}},xhr.send(formData)};var $inputFileElement=$(attrs.uploadFiles);$inputFileElement.on("change",function(){console.log("Change beginning the upload");for(var files=$inputFileElement[0].files,formData=new FormData,i=0;i<files.length;i++){var mediaFile=files[i];mediaFile.originalFilename=files[i].name,formData.append("file",mediaFile)}var file=files[0],reader=new FileReader;reader.onload=function(evt){var filename="",filenameSplitted=file.name.split(".");filenameSplitted.pop();for(var i=0;i<filenameSplitted.length;i++)filename+=filenameSplitted[i],i<filenameSplitted.length-1&&(filename+=".");evt.target.filename=filename,$rootScope.$broadcast("Biin: on fileUploaded",evt)},file&&reader.readAsDataURL(file)}),$(element[0]).on("click touch",function(e){$inputFileElement.trigger("click")})}}}angular.module("gallery").directive("uploadFiles",UploadFiles),UploadFiles.$inject=["$modal","Organization","$rootScope"]}(),function(){function Gallery($http){var service={getList:function(organization){var promise=$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+organization+"/gallery").success(function(data){return data.data}).error(function(data){return{status:!1}});return promise}};return service}angular.module("gallery").service("Gallery",Gallery),Gallery.$inject=["$http"]}(),angular.module("gmaps").controller("GmapController",GmapController),GmapController.$inject=["$scope","$modalInstance"],function(){function StaticMap(ObjectsSidebar){return{restrict:"A",link:function(scope,element,attrs){function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,errorCallback,{timeout:1e4}):element[0].innerHTML="Geolocation is not supported by this browser."}function showPosition(position,otherZoom){"undefined"!=typeof otherZoom&&(zoom=otherZoom);var myPosition=new google.maps.LatLng(position.coords.latitude,position.coords.longitude),mapOptions={center:myPosition,zoom:zoom};map.setOptions(mapOptions),marker=new google.maps.Marker({map:map,draggable:!0,animation:google.maps.Animation.DROP,position:myPosition}),google.maps.event.addListener(marker,"position_changed",function(){var newPosition=marker.getPosition();scope.changeLocation(newPosition.lat(),newPosition.lng())}),google.maps.event.addListenerOnce(map,"idle",function(){var newPosition=marker.getPosition();google.maps.event.trigger(map,"resize"),map.setCenter(newPosition)})}function errorCallback(err){var coords={latitude:local_lat,longitude:local_lng};showPosition({coords:coords},1),console.warn("ERROR("+err.code+"): "+err.message)}var local_lat=ObjectsSidebar.selectedObject.lat,local_lng=ObjectsSidebar.selectedObject.lng,zoom=eval(attrs.zoom),defPosition=new google.maps.LatLng(local_lat,local_lng),defOptions={center:defPosition,zoom:zoom},map=new google.maps.Map(element[0],defOptions),marker;if(0==local_lat&&0==local_lng)getLocation();else{var coords={latitude:local_lat,longitude:local_lng};showPosition({coords:coords})}}}}angular.module("gmaps").directive("map",StaticMap),StaticMap.$inject=["ObjectsSidebar"]}(),function(){function StaticMap(ObjectsSidebar,$modal){return{restrict:"A",link:function(scope,element,attrs){function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,errorCallback,{timeout:1e4}):element[0].innerHTML="Geolocation is not supported by this browser."}function showPosition(position,otherZoom){"undefined"!=typeof otherZoom&&(zoom=otherZoom),0!=$(element).children("img").length&&$(element).children("img")[0].remove();var imageElement=document.createElement("img");imageElement.setAttribute("src","https://maps.googleapis.com/maps/api/staticmap?center="+position.coords.latitude+","+position.coords.longitude+"&zoom="+zoom+"&size=1024x512&markers="+ObjectsSidebar.selectedObject.lat+","+ObjectsSidebar.selectedObject.lng),imageElement.className+="img-responsive",element[0].appendChild(imageElement)}function errorCallback(err){var coords={latitude:local_lat,longitude:local_lng};showPosition({coords:coords},1),console.warn("ERROR("+err.code+"): "+err.message)}function showMap(){if(attrs.lat&&attrs.lng&&(local_lat=eval(attrs.lat),local_lng=eval(attrs.lng)),0==local_lat&&0==local_lng)getLocation();else{var coords={latitude:local_lat,longitude:local_lng};showPosition({coords:coords})}}var zoom=eval(attrs.zoom),marker;scope.showMapModal=function(){var mapInstance=$modal.open({templateUrl:"/modules/gmaps/views/partials/gmap.modal.client.partial.view.html",controller:"GmapController",backdrop:"static",size:"lg"});mapInstance.result.then(function(position){position&&(ObjectsSidebar.selectedObject.lng=position.lng,ObjectsSidebar.selectedObject.lat=position.lat)},function(){})};var local_lat=0,local_lng=0;showMap(),attrs.$observe("lat",function(newValue,oldValue){showMap()}),attrs.$observe("lng",function(newValue,oldValue){showMap()})}}}angular.module("gmaps").directive("staticmap",StaticMap),StaticMap.$inject=["ObjectsSidebar","$modal"]}(),function(){function lazyloadConfig($ocLazyLoadProvider,APP_REQUIRES){$ocLazyLoadProvider.config({debug:!1,events:!0,modules:APP_REQUIRES.modules})}angular.module("app.lazyload").config(lazyloadConfig),lazyloadConfig.$inject=["$ocLazyLoadProvider","APP_REQUIRES"]}(),function(){angular.module("app.lazyload").constant("APP_REQUIRES",{scripts:{modernizr:["/lib/modernizr/modernizr.js"],icons:["/lib/fontawesome/css/font-awesome.min.css","/lib/simple-line-icons/css/simple-line-icons.css"],filestyle:["/lib/bootstrap-filestyle/src/bootstrap-filestyle.js"]},modules:[]})}(),function(){function loadingbarConfig(cfpLoadingBarProvider){cfpLoadingBarProvider.includeBar=!0,cfpLoadingBarProvider.includeSpinner=!1,cfpLoadingBarProvider.latencyThreshold=500,cfpLoadingBarProvider.parentSelector=".wrapper > section"}angular.module("app.loadingbar").config(loadingbarConfig),loadingbarConfig.$inject=["cfpLoadingBarProvider"]}(),function(){function loadingbarRun($rootScope,$timeout,cfpLoadingBar){var thBar;$rootScope.$on("$stateChangeStart",function(){$(".wrapper > section").length&&(thBar=$timeout(function(){cfpLoadingBar.start()},0))}),$rootScope.$on("$stateChangeSuccess",function(event){event.targetScope.$watch("$viewContentLoaded",function(){$timeout.cancel(thBar),cfpLoadingBar.complete()})})}angular.module("app.loadingbar").run(loadingbarRun),loadingbarRun.$inject=["$rootScope","$timeout","cfpLoadingBar"]}(),angular.module("maintenance").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.maintenance",{url:"/maintenance",templateUrl:"modules/maintenance/views/maintenance.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function MaintenanceController($http,$state,$timeout,$scope,$modal,Authentication,ObjectsSidebar,Loading){function activate(){$scope.authentication=Authentication,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0}activate(),$scope.objectsSidebarService=ObjectsSidebar,$scope.objectsSidebarService.template="<div class='maintenanceList leftInformationArea'><label class='twoRowTitle'>{{item.name}}</label><label class='twoRowSubtitle'>{{item.assignedBeacons}} Beacons</label> </div>",$scope.objectsSidebarService.enableAddButton=!1,$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.$on("Biin: On Object Clicked",function(event,objectClicked){$scope.showBiinsPerOrganization(objectClicked)}),$http.get(ApplicationConfiguration.applicationBackendURL+"maintenance/organizations").success(function(data){$scope.objectsSidebarService.setObjects(data),$scope.loadingService.isLoading=!1;for(var i=0;i<$scope.objectsSidebarService.objects.length;i++)$scope.objectsSidebarService.objects[i].unassignedBeacons=$scope.objectsSidebarService.objects[i].biinsCounter-$scope.objectsSidebarService.objects[i].biinsAssignedCounter,$scope.objectsSidebarService.objects[i].assignedBeacons=$scope.objectsSidebarService.objects[i].biinsAssignedCounter;$scope.selectedOrganization=null,$scope.biinsXOrganization=null,$scope.defaultUUID="",$scope.getTypeName=function(type){return"1"==type?"External":"2"==type?"Internal":"Product"},$scope.showBiinsPerOrganization=function(selectedObject){$http.get(ApplicationConfiguration.applicationBackendURL+"maintenance/getBiinsOrganizationInformation/"+$scope.objectsSidebarService.selectedObject.identifier).success(function(data){$scope.objectsSidebarService.selectedObject.biins=data.biins,$scope.defaultUUID=data.defaultUUID,$scope.biinsXOrganization=$scope.objectsSidebarService.selectedObject.biins;for(var i=0;i<$scope.biinsXOrganization.length;i++)for(var j=0;j<selectedObject.sites.length;j++)if($scope.biinsXOrganization[i].siteIdentifier==selectedObject.sites[j].identifier){$scope.biinsXOrganization[i].siteName=selectedObject.sites[j].title2;break}})},$scope.showAddBiintoOrganizationModal=function(mode,beacon){var modalInstance=$modal.open({templateUrl:"/modules/maintenance/views/partials/managebiintoorganization.client.modal.html",controller:"manageBiinToOrganization",size:"lg",resolve:{selectedElement:function(){return{sites:$scope.objectsSidebarService.selectedObject.sites}},mode:function(){return mode},beacon:function(){return beacon},selectedOrganization:function(){return{organization:$scope.objectsSidebarService.selectedObject}},defaultUUID:function(){return $scope.defaultUUID}}});modalInstance.result.then(function(beacon){$scope.showBiinsPerOrganization($scope.objectsSidebarService.selectedObject),"create"==mode?($scope.objectsSidebarService.selectedObject.sites[beacon.siteIndex].minorCounter=$scope.objectsSidebarService.selectedObject.sites[beacon.siteIndex].minorCounter?$scope.objectsSidebarService.selectedObject.sites[beacon.siteIndex].minorCounter+1:1,$scope.objectsSidebarService.selectedObject.assignedBeacons=$scope.objectsSidebarService.selectedObject.assignedBeacons?$scope.objectsSidebarService.selectedObject.assignedBeacons+1:1):beacon.minorHasChanged&&"1"!=beacon.biinType&&($scope.objectsSidebarService.selectedObject.sites[beacon.siteIndex].minorCounter=$scope.objectsSidebarService.selectedObject.sites[beacon.siteIndex].minorCounter+1,delete beacon.minorHasChanged)},function(){$scope.showBiinsPerOrganization($scope.objectsSidebarService.selectedObject)})}}).error(function(err){console.log(err)})}angular.module("maintenance").controller("MaintenanceController",MaintenanceController),MaintenanceController.$inject=["$http","$state","$timeout","$scope","$modal","Authentication","ObjectsSidebar","Loading"]}(),function(){function ManageBiinToOrganization($scope,$modalInstance,$http,selectedElement,mode,beacon,selectedOrganization,defaultUUID){if($scope.sites=selectedElement.sites,$scope.mode=mode,$scope.beacon=null,$scope.selectedOrganization=selectedOrganization.organization,$scope.minor=0,$scope.siteIndexFromBeacon=0,$scope.lockValues=!1,$scope.minorHasChanged=!1,$scope.siteMinor=0,"create"==mode)$scope.sites.length>0&&($scope.selectedSite=$scope.sites[0],$scope.minor=parseInt($scope.selectedSite.minorCounter)+1,$scope.siteMinor=parseInt($scope.selectedSite.minorCounter)+1),$scope.beacon={identifier:"",name:"",status:"No Programmed",proximityUUID:defaultUUID,registerDate:"",biinType:"3",venue:""};else{$scope.beacon=beacon,$scope.minor=parseInt(beacon.minor),$scope.lockValues="No Programmed"!=$scope.beacon.status,$scope.initialBeaconType=$scope.beacon.biinType,$scope.isExternalBeaconType="1"==$scope.beacon.biinType;for(var i=0;i<$scope.sites.length;i++)if($scope.sites[i].identifier==$scope.beacon.siteIdentifier){$scope.selectedSite=$scope.sites[i];break}}$scope.save=function(){$scope.beacon.major=$scope.selectedSite.major,$scope.beacon.siteIdentifier=$scope.selectedSite.identifier,$scope.beacon.siteIndex=$scope.sites.indexOf($scope.selectedSite),$scope.beacon.isAssigned=!0,$scope.beacon.organizationIdentifier=$scope.selectedOrganization.identifier,$scope.beacon.accountIdentifier=$scope.selectedOrganization.accountIdentifier,$scope.beacon.minor=$scope.minor,$scope.beacon.siteMinor=$scope.siteMinor,"create"==$scope.mode?($scope.beacon.mode="create",$http.put(ApplicationConfiguration.applicationBackendURL+"maintenance/insertBiin",$scope.beacon).success(function(data,status){$modalInstance.close($scope.beacon)}).error(function(data,status){$scope.message=data.message,console.log(data),console.log(status)})):($scope.beacon.mode="edit",$http.post(ApplicationConfiguration.applicationBackendURL+"maintenance/insertBiin",$scope.beacon).success(function(data,status){console.log("success"),$scope.beacon.minorHasChanged=$scope.minorHasChanged,$modalInstance.close($scope.beacon)}).error(function(data,status){console.log(data),console.log(status)}))},$scope.selectSite=function(site){"1"==$scope.beacon.biinType?($scope.minor=1,$scope.siteMinor="create"==mode?parseInt(site.minorCounter):parseInt(site.minorCounter)+1):"create"==mode?($scope.minor=parseInt(site.minorCounter)+1,$scope.siteMinor=parseInt(site.minorCounter)+1):$scope.siteIndexFromBeacon==$scope.sites.indexOf(site)&&$scope.isExternalBeaconType?($scope.minor=parseInt($scope.beacon.minor),$scope.siteMinor=parseInt(site.minorCounter),$scope.minorHasChanged=!1):($scope.minor=parseInt(site.minorCounter)+1,$scope.siteMinor=parseInt(site.minorCounter)+1,$scope.minorHasChanged=!0),$scope.selectedSite=site},$scope.onTypeChange=function(value){"1"==value?($scope.minor=1,$scope.minorHasChanged=!$scope.isExternalBeaconType):$scope.siteIndexFromBeacon==$scope.selectedSite&&$scope.isExternalBeaconType==("1"==value)?($scope.minor=parseInt($scope.beacon.minor),
$scope.siteMinor=parseInt($scope.selectedSite.minorCounter),$scope.minorHasChanged=!1):($scope.minorHasChanged=!0,$scope.minor=parseInt($scope.selectedSite.minorCounter)+1,$scope.siteMinor=parseInt($scope.selectedSite.minorCounter)+1)},$scope.selectStatus=function(status){$scope.lockValues="No Programmed"!=status},$scope.ok=function(){$modalInstance.close($scope.objectIndex)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}angular.module("maintenance").controller("manageBiinToOrganization",ManageBiinToOrganization),ManageBiinToOrganization.$inject=["$scope","$modalInstance","$http","selectedElement","mode","beacon","selectedOrganization","defaultUUID"]}(),function(){function searchOpen(){var directive={controller:searchOpenController,restrict:"A"};return directive}function searchDismiss(){var directive={controller:searchDismissController,restrict:"A"};return directive}function searchOpenController($scope,$element,NavSearch){$element.on("click",function(e){e.stopPropagation()}).on("click",NavSearch.toggle)}function searchDismissController($scope,$element,NavSearch){var inputSelector='.navbar-form input[type="text"]';$(inputSelector).on("click",function(e){e.stopPropagation()}).on("keyup",function(e){27===e.keyCode&&NavSearch.dismiss()}),$(document).on("click",NavSearch.dismiss),$element.on("click",function(e){e.stopPropagation()}).on("click",NavSearch.dismiss)}angular.module("app.navsearch").directive("searchOpen",searchOpen).directive("searchDismiss",searchDismiss),searchOpenController.$inject=["$scope","$element","NavSearch"],searchDismissController.$inject=["$scope","$element","NavSearch"]}(),function(){function NavSearch(){function toggle(){var navbarForm=$(navbarFormSelector);navbarForm.toggleClass("open");var isOpen=navbarForm.hasClass("open");navbarForm.find("input")[isOpen?"focus":"blur"]()}function dismiss(){$(navbarFormSelector).removeClass("open").find('input[type="text"]').blur().val("")}this.toggle=toggle,this.dismiss=dismiss;var navbarFormSelector="form.navbar-form"}angular.module("app.navsearch").service("NavSearch",NavSearch)}(),angular.module("nps").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.nps",{url:"/nps",templateUrl:"modules/nps/views/nps.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function NPSController($http,$state,$scope,Authentication,toaster,$location,Organization,ObjectsSidebar,Loading){function isSameDateAs(pDate1,pDate2){return pDate1.getFullYear()===pDate2.getFullYear()&&pDate1.getMonth()===pDate2.getMonth()&&pDate1.getDate()===pDate2.getDate()}function getDates(startDate,stopDate){for(var dateArray=new Array,currentDate=startDate;stopDate>=currentDate;)dateArray.push(currentDate),currentDate=currentDate.addDays(1);return dateArray}function activate(){$scope.authentication=Authentication,$http.get(ApplicationConfiguration.applicationBackendURL+"ratings/organization",{headers:{organizationid:$scope.organizationService.selectedOrganization.identifier}}).success(function(data){"1"==data.result&&(updateNPSValues(data.data),$scope.loadingService.isLoading=!1)}),resetNPS()}function updateNPSValues(data){if(resetNPS(),Array.isArray(data)&&data.length>0){for(var dateArray=getDates((new Date).addDays(-6),new Date),totalCases=0,i=0;i<dateArray.length;i++)for(var j=0;j<data.length;j++)isSameDateAs(new Date(data[j].date),dateArray[i])&&(data[j].rating<7?$scope.detractorsQuantity++:data[j].rating<9?$scope.passiveQuantity++:$scope.promotersQuantity++,totalCases++);$scope.promotersPercentage=$scope.promotersQuantity/totalCases*100,$scope.passivePercentage=$scope.passiveQuantity/totalCases*100,$scope.detractorsPercentage=$scope.detractorsQuantity/totalCases*100,$scope.npsScore=$scope.promotersPercentage-$scope.detractorsPercentage}generateChartData(data)}function resetNPS(){$scope.promotersQuantity=0,$scope.passiveQuantity=0,$scope.detractorsQuantity=0,$scope.npsScore=0,$scope.promotersPercentage=0,$scope.passivePercentage=0,$scope.detractorsPercentage=0}function generateChartData(data){for(var dateArray=getDates((new Date).addDays(-6),new Date),npsDataForChart=[],i=0;i<dateArray.length;i++){var npsObject={};npsObject.date=dateArray[i],npsObject.nps=0;for(var tempnpspromoter=0,tempnpspasive=0,tempnpsdetractor=0,j=0;j<data.length;j++)isSameDateAs(new Date(data[j].date),dateArray[i])&&(data[j].rating<7?tempnpsdetractor++:data[j].rating<9?tempnpspasive++:tempnpspromoter++);var totalnps=tempnpsdetractor+tempnpspasive+tempnpspromoter;if(totalnps>0){var nps=tempnpspromoter/totalnps*100-tempnpsdetractor/totalnps*100;npsObject.nps=nps}npsDataForChart.push(npsObject)}var graphData=[];for(i=0;i<npsDataForChart.length;i++)graphData.push({x:npsDataForChart[i].date,y:npsDataForChart[i].nps});$scope.data=[{values:graphData,color:"#fe5621",key:"NPS",area:!0}]}$scope.organizationService=Organization,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.$on("organizationChanged",function(){$scope.loadingService.isLoading=!0,$http.get(ApplicationConfiguration.applicationBackendURL+"ratings/organization",{headers:{organizationid:$scope.organizationService.selectedOrganization.identifier}}).success(function(data){"1"==data.result&&(updateNPSValues(data.data),$scope.loadingService.isLoading=!1)})}),$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),Authentication.user||$location.path("/"),Date.prototype.addDays=function(days){var dat=new Date(this.valueOf());return dat.setDate(dat.getDate()+days),dat},activate(),$scope.save=function(){$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier,{model:$scope.organizationService.selectedOrganization}).success(function(data,status){200===status?$scope.succesSaveShow=!0:$scope.errorSaveShow=!0})},$scope.options={chart:{type:"lineChart",height:150,margin:{top:20,right:20,bottom:40,left:55},x:function(d){return d.x},y:function(d){return d.y},useInteractiveGuideline:!0,dispatch:{stateChange:function(e){console.log("stateChange")},changeState:function(e){console.log("changeState")},tooltipShow:function(e){console.log("tooltipShow")},tooltipHide:function(e){console.log("tooltipHide")}},xAxis:{tickFormat:function(d){return d3.time.format("%d-%m-%y")(new Date(d))}},yAxis:{axisLabel:"NPS",axisLabelDistance:-10},callback:function(chart){}}}}angular.module("nps").controller("NPSController",NPSController),NPSController.$inject=["$http","$state","$scope","Authentication","toaster","$location","Organization","ObjectsSidebar","Loading"]}(),function(){function ObjectsSideBar($http,$state,$scope,$rootScope,ObjectsSidebar){function activate(){}activate(),$scope.isHidden=!1,$scope.objectsSidebarService=ObjectsSidebar,$scope.onObjectClick=function(index){var objectClicked=$scope.objectsSidebarService.getObjects()[index];$scope.objectsSidebarService.selectedObject=objectClicked,$rootScope.$broadcast("Biin: On Object Clicked",objectClicked)},$scope.create=function(){$rootScope.$broadcast("Biin: On Object Created")},$scope.hideObjectsMenu=function(){$scope.isHidden?($(".right-section-content").removeClass("extended"),$(".objects-sidebar").removeClass("contracted")):($(".right-section-content").addClass("extended"),$(".objects-sidebar").addClass("contracted")),$scope.isHidden=!$scope.isHidden},$scope.deleteItem=function(index,$event){console.warn("Delete clicked "+index),$event.stopPropagation(),$rootScope.$broadcast("Biin: On Object Deleted",index)}}angular.module("objectssidebar").controller("ObjectsSideBar",ObjectsSideBar),ObjectsSideBar.$inject=["$http","$state","$scope","$rootScope","ObjectsSidebar"]}(),function(){function ObjectsSidebar(){return{objects:[],selectedObject:null,template:"",loadedInformation:!1,enableAddButton:!0,setObjects:function(objects){this.objects=objects},getObjects:function(){return this.objects},setSelectedObject:function(selectedObject){this.selectedObject=selectedObject},getSelectedObject:function(){return this.selectedObject},reset:function(){this.objects=[],this.selectedObject=null,this.template="",this.enableAddButton=!0}}}angular.module("objectssidebar").service("ObjectsSidebar",ObjectsSidebar),ObjectsSidebar.$inject=[]}(),angular.module("organization").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.organization",{url:"/organization",templateUrl:"modules/organization/views/organization.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function OrganizationController($http,$state,$scope,Authentication,toaster,$location,Organization,ObjectsSidebar,Loading){function activate(){$scope.authentication=Authentication,$scope.editOrganization(0)}$scope.objectsSidebarService=ObjectsSidebar,$scope.organizationService=Organization,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.sidebarTemplate="<div class='col-md-3 thumbListImage'><img ng-if='item.media.length == 0  || item.media[0].media.length == 0 ' src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjcwIiB5PSI3MCIgc3R5bGU9ImZpbGw6I2FhYTtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjE0MHgxNDA8L3RleHQ+PC9zdmc+' alt=''/><img ng-if='item.media.length>0' ng-src='{{item.media[0].url}}'/></div><div class='col-md-9 leftInformationArea'><label class='oneRowTitle'>{{item.name}}</label></div>",$scope.objectsSidebarService.template=$scope.sidebarTemplate,$scope.objectsSidebarService.setObjects($scope.organizationService.organizationsList);for(var permit=0;permit<Authentication.user.permissions.length;permit++)if("delete"==Authentication.user.permissions[permit].permission){$scope.deletePermit=!0;break}$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.$on("organizationChanged",function(){}),$scope.$on("Biin: On Object Clicked",function(event,objectClicked){$scope.editOrganization()}),$scope.$on("Biin: On Object Created",function(){$scope.createOrganization()}),$scope.$on("Biin: On Object Deleted",function(event,index){$scope.removeOrganization(index)}),$scope.$on("changeOrganizationImage",function(scope,newPicture){$scope.objectsSidebarService.selectedObject.media[0]=newPicture}),Authentication.user||$location.path("/"),$scope.saveOrganization=function(){if(!$scope.isAnalazingOrg){if(isOrganizationDirty()){var currentOrganization=$scope.objectsSidebarService.selectedObject;$scope.prevSaveOrganization=jQuery.extend({},currentOrganization),$scope.isAnalazingOrg=!1,currentOrganization.accountIdentifier=Authentication.user.accountIdentifier,currentOrganization.isDeleted=0,$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+currentOrganization.identifier,{model:currentOrganization}).success(function(data,status){200===status?$scope.succesSaveShow=!0:$scope.errorSaveShow=!0})}$scope.isAnalazingOrg=!1}},$scope.editOrganization=function(){$scope.prevSaveOrganization=jQuery.extend({},$scope.objectsSidebarService.selectedObject)},$scope.createOrganization=function(){$http.put(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+Authentication.user.accountIdentifier).success(function(org,status){201==status||200==status?($scope.organizationService.organizationsList.push(org),$scope.objectsSidebarService.selectedObject=org):displayErrorMessage(org,"Organizations Creation",status)})},$scope.deleteOrganization=function(message,selectedObject){confirm(message)&&$scope.removeOrganization($scope.objectsSidebarService.objects.indexOf(selectedObject))},$scope.removeOrganization=function(index){var id=$scope.objectsSidebarService.objects[index].identifier;$http["delete"](ApplicationConfiguration.applicationBackendURL+"api/organizations/"+id).success(function(data){$scope.organizationService.removeOrganization(id),$scope.objectsSidebarService.objects.splice(index,1)})};var isOrganizationDirty=function(){$scope.isAnalazingOrg=!0;var propertiesToCheck=["name","brand","description","extraInfo","isPublished","isUsingBrandColors","primaryColor","secondaryColor"],foundChange=!1;if(null!==$scope.prevSaveOrganization)for(var i=0;i<propertiesToCheck.length&&!foundChange;i++)foundChange=$scope.objectsSidebarService.selectedObject[propertiesToCheck[i]]!==$scope.prevSaveOrganization[propertiesToCheck[i]];return foundChange};activate(),$scope.loadingService.isLoading=!1}angular.module("organization").controller("OrganizationController",OrganizationController),OrganizationController.$inject=["$http","$state","$scope","Authentication","toaster","$location","Organization","ObjectsSidebar","Loading"]}(),function(){function uploadOrganizationImage($rootScope,Authentication,ObjectsSidebar){return{restrict:"A",link:function(scope,element,attrs){var $inputFileElement=$(attrs.uploadOrganizationImage);$inputFileElement.on("change",function(){console.log("Change beginning the upload");for(var files=$inputFileElement[0].files,formData=new FormData,i=0;i<files.length;i++){var mediaFile=files[i];mediaFile.originalFilename=files[i].name,formData.append("file",mediaFile)}var xhr=new XMLHttpRequest,organization=ObjectsSidebar.selectedObject.identifier;xhr.open("POST",ApplicationConfiguration.applicationBackendURL+"api/organizations/"+organization+"/image"),xhr.setRequestHeader("accountidentifier",Authentication.user.accountIdentifier),xhr.onload=function(data){if(200===xhr.status){var obj=$.parseJSON(xhr.response);$rootScope.$broadcast("changeOrganizationImage",obj.data),console.log("all done: "+xhr.status)}else console.log("Something went terribly wrong...")},xhr.upload.onprogress=function(event){if(event.lengthComputable){event.loaded/event.total*100|0}},xhr.send(formData)}),$(element[0]).on("click touch",function(e){$inputFileElement.trigger("click")})}}}angular.module("organization").directive("uploadOrganizationImage",uploadOrganizationImage),uploadOrganizationImage.$inject=["$rootScope","Authentication","ObjectsSidebar"]}(),angular.module("page").config(["$stateProvider",function($stateProvider){$stateProvider.state("page",{url:"/page",templateUrl:"modules/page/views/page.client.view.html"})}]),function(){function PanelsCtrl($scope,$timeout){function activate(){$scope.$watch("panelDemo1",function(newVal){console.log("panelDemo1 collapsed: "+newVal)}),$scope.$on("panel-remove",function(event,id,deferred){console.log("Panel #"+id+" removing"),deferred.resolve()}),$scope.$on("panel-removed",function(event,id){console.log("Panel #"+id+" removed")}),$scope.$on("panel-refresh",function(event,id){var secs=3;console.log("Refreshing during "+secs+"s #"+id),$timeout(function(){$scope.$broadcast("removeSpinner",id),console.log("Refreshed #"+id)},3e3)}),$scope.panels=[{id:"panelRepeat1",title:"Panel Title 1",body:"Nulla eget lorem leo, sit amet elementum lorem. "},{id:"panelRepeat2",title:"Panel Title 2",body:"Nulla eget lorem leo, sit amet elementum lorem. "},{id:"panelRepeat3",title:"Panel Title 3",body:"Nulla eget lorem leo, sit amet elementum lorem. "}]}activate()}angular.module("app.panels").controller("PanelsCtrl",PanelsCtrl),PanelsCtrl.$inject=["$scope","$timeout"]}(),function(){function panelCollapse(){var directive={controller:Controller,restrict:"A",scope:!1};return directive}function Controller($scope,$element,$timeout,$localStorage){function savePanelState(id,state){if(!id)return!1;var data=angular.fromJson($localStorage[storageKeyName]);data||(data={}),data[id]=state,$localStorage[storageKeyName]=angular.toJson(data)}function loadPanelState(id){if(!id)return!1;var data=angular.fromJson($localStorage[storageKeyName]);return data?data[id]:void 0}var storageKeyName="panelState",$elem=$($element),parent=$elem.closest(".panel"),panelId=parent.attr("id"),currentState=loadPanelState(panelId);"undefined"!=typeof currentState&&$timeout(function(){$scope[panelId]=currentState},10),$element.bind("click",function(e){e.preventDefault(),savePanelState(panelId,!$scope[panelId])})}angular.module("app.panels").directive("panelCollapse",panelCollapse),Controller.$inject=["$scope","$element","$timeout","$localStorage"]}(),function(){function panelDismiss(){var directive={controller:Controller,restrict:"A"};return directive}function Controller($scope,$element,$q,Utils){var removeEvent="panel-remove",removedEvent="panel-removed";$element.on("click",function(e){function removeElement(){var deferred=$q.defer(),promise=deferred.promise;$scope.$emit(removeEvent,parent.attr("id"),deferred),promise.then(destroyMiddleware,function(resp){console.error(resp)})}function destroyMiddleware(){Utils.support.animation?parent.animo({animation:"bounceOut"},destroyPanel):destroyPanel()}function destroyPanel(){var col=parent.parent();parent.remove(),col.filter(function(){var el=$(this);return el.is('[class*="col-"]:not(.sortable)')&&0===el.children("*").length}).remove(),$scope.$emit(removedEvent,parent.attr("id"))}e.preventDefault();var parent=$(this).closest(".panel");removeElement()})}angular.module("app.panels").directive("panelDismiss",panelDismiss),Controller.$inject=["$scope","$element","$q","Utils"]}(),function(){function panelRefresh(){var directive={controller:Controller,restrict:"A",scope:!1};return directive}function Controller($scope,$element){function removeSpinner(ev,id){if(id){var newid="#"===id.charAt(0)?id:"#"+id;angular.element(newid).removeClass(whirlClass)}}var refreshEvent="panel-refresh",whirlClass="whirl",defaultSpinner="standard";$element.on("click",function(e){e.preventDefault();var $this=$(this),panel=$this.parents(".panel").eq(0),spinner=$this.data("spinner")||defaultSpinner;panel.addClass(whirlClass+" "+spinner),$scope.$emit(refreshEvent,panel.attr("id"))}),$scope.$on("removeSpinner",removeSpinner)}angular.module("app.panels").directive("panelRefresh",panelRefresh),Controller.$inject=["$scope","$element"]}(),function(){function paneltool($compile,$timeout){function link(scope,element,attrs){function getTemplate(elem,attrs){var temp="";return attrs=attrs||{},attrs.toolCollapse&&(temp+=templates.collapse.replace(/{{panelId}}/g,elem.parent().parent().attr("id"))),attrs.toolDismiss&&(temp+=templates.dismiss),attrs.toolRefresh&&(temp+=templates.refresh.replace(/{{spinner}}/g,attrs.toolRefresh)),temp}var templates={collapse:'<a href="#" panel-collapse="" tooltip="Collapse Panel" ng-click="{{panelId}} = !{{panelId}}">                         <em ng-show="{{panelId}}" class="fa fa-plus"></em>                         <em ng-show="!{{panelId}}" class="fa fa-minus"></em>                       </a>',dismiss:'<a href="#" panel-dismiss="" tooltip="Close Panel">                       <em class="fa fa-times"></em>                     </a>',refresh:'<a href="#" panel-refresh="" data-spinner="{{spinner}}" tooltip="Refresh Panel">                       <em class="fa fa-refresh"></em>                     </a>'},tools=scope.panelTools||attrs;$timeout(function(){element.html(getTemplate(element,tools)).show(),$compile(element.contents())(scope),element.addClass("pull-right")})}var directive={link:link,restrict:"E",scope:!1};return directive}angular.module("app.panels").directive("paneltool",paneltool),paneltool.$inject=["$compile","$timeout"]}(),function(){function portlet($timeout,$localStorage){function link(scope,element){$.fn.sortable&&element.sortable({connectWith:"[portlet]",items:"div.panel",handle:".portlet-handler",opacity:.7,placeholder:"portlet box-placeholder",cancel:".portlet-cancel",forcePlaceholderSize:!0,iframeFix:!1,tolerance:"pointer",helper:"original",revert:200,forceHelperSize:!0,update:savePortletOrder,create:loadPortletOrder})}function savePortletOrder(event){var self=event.target,data=angular.fromJson($localStorage[storageKeyName]);data||(data={}),data[self.id]=$(self).sortable("toArray"),data&&$timeout(function(){$localStorage[storageKeyName]=angular.toJson(data)})}function loadPortletOrder(event){var self=event.target,data=angular.fromJson($localStorage[storageKeyName]);if(data){var porletId=self.id,panels=data[porletId];if(panels){var portlet=$("#"+porletId);$.each(panels,function(index,value){$("#"+value).appendTo(portlet)})}}}var storageKeyName="portletState";return{restrict:"A",link:link}}angular.module("app.panels").directive("portlet",portlet),portlet.$inject=["$timeout","$localStorage"]}(),function(){function preloader($animate,$timeout,$q){function link(scope,el){function startCounter(){var remaining=100-counter;counter+=.015*Math.pow(1-Math.sqrt(remaining),2),scope.loadCounter=parseInt(counter,10),timeout=$timeout(startCounter,20)}function endCounter(){$timeout.cancel(timeout),scope.loadCounter=100,$timeout(function(){$animate.addClass(el,"preloader-hidden"),angular.element("body").css("overflow","")},300)}function appReady(){var deferred=$q.defer(),viewsLoaded=0,off=scope.$on("$viewContentLoaded",function(){viewsLoaded++,2===viewsLoaded&&($timeout(function(){deferred.resolve()},3e3),off())});return deferred.promise}scope.loadCounter=0;var timeout,counter=0;angular.element("body").css("overflow","hidden"),el.addClass("preloader"),appReady().then(endCounter),timeout=$timeout(startCounter)}var directive={restrict:"EAC",template:'<div class="preloader-progress"><div class="preloader-progress-bar" ng-style="{width: loadCounter + \'%\'}"></div></div>',link:link};return directive}angular.module("app.preloader").directive("preloader",preloader),preloader.$inject=["$animate","$timeout","$q"]}(),angular.module("dashboard").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.profile",{url:"/profile",templateUrl:"modules/profile/views/profile.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function ProfileController($http,$state,$scope,Authentication,toaster,$location,Organization,Loading){function activate(){$scope.authentication=Authentication,$http.get("/api/account").success(function(data){$scope.profile=data.data,$scope.loadingService.isLoading=!1})}$scope.organizationService=Organization,Authentication.user||$location.path("/"),$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.saveInformation=function(){"undefined"!=typeof $scope.profile&&isProfileDirty()&&$http.put("api/account",{model:$scope.profile}).success(function(data,status){200===status?data.needToRelog?window.location.href="/auth/signout":toaster.pop("success","","Your information has been saved"):toaster.pop("error","Error","Your information has not been saved")}).error(function(){toaster.pop("error","Error","Your information has not been saved")})};var isProfileDirty=function(){return!0};$scope.$on("changeProfileImage",function(scope,image){$scope.profile.profilePhoto=image+"?"+(new Date).getTime(),$scope.$digest(),$scope.$apply()}),activate()}angular.module("profile").controller("ProfileController",ProfileController),ProfileController.$inject=["$http","$state","$scope","Authentication","toaster","$location","Organization","Loading"]}(),function(){function uploadProfileImage($rootScope,Authentication,ObjectsSidebar){return{restrict:"A",link:function(scope,element,attrs){var $inputFileElement=$(attrs.uploadProfileImage);$inputFileElement.on("change",function(){console.log("Change beginning the upload");for(var files=$inputFileElement[0].files,formData=new FormData,i=0;i<files.length;i++){var mediaFile=files[i];mediaFile.originalFilename=files[i].name,formData.append("file",mediaFile)}var xhr=new XMLHttpRequest;xhr.open("POST",ApplicationConfiguration.applicationBackendURL+"api/imageProfile"),xhr.setRequestHeader("accountidentifier",Authentication.user.accountIdentifier),xhr.setRequestHeader("name",Authentication.user.name),xhr.onload=function(data){if(200===xhr.status){var obj=$.parseJSON(xhr.response);$rootScope.$broadcast("changeProfileImage",obj.data),console.log("all done: "+xhr.status)}else console.log("Something went terribly wrong...")},xhr.upload.onprogress=function(event){if(event.lengthComputable){event.loaded/event.total*100|0}},xhr.send(formData)}),$(element[0]).on("click touch",function(e){$inputFileElement.trigger("click")})}}}angular.module("profile").directive("uploadProfileImage",uploadProfileImage),uploadProfileImage.$inject=["$rootScope","Authentication","ObjectsSidebar"]}(),function(){function RouteHelpersProvider(APP_REQUIRES){function basepath(uri){return"app/views/"+uri}function resolveFor(){var _args=arguments;return{deps:["$ocLazyLoad","$q",function($ocLL,$q){function andThen(_arg){return"function"==typeof _arg?promise.then(_arg):promise.then(function(){var whatToLoad=getRequired(_arg);return whatToLoad?$ocLL.load(whatToLoad):$.error("Route resolve: Bad resource name ["+_arg+"]")})}function getRequired(name){if(APP_REQUIRES.modules)for(var m in APP_REQUIRES.modules)if(APP_REQUIRES.modules[m].name&&APP_REQUIRES.modules[m].name===name)return APP_REQUIRES.modules[m];return APP_REQUIRES.scripts&&APP_REQUIRES.scripts[name]}for(var promise=$q.when(1),i=0,len=_args.length;len>i;i++)promise=andThen(_args[i]);return promise}]}}return{basepath:basepath,resolveFor:resolveFor,$get:function(){return{basepath:basepath,resolveFor:resolveFor}}}}angular.module("app.routes").provider("RouteHelpers",RouteHelpersProvider),RouteHelpersProvider.$inject=["APP_REQUIRES"]}(),function(){function settingsRun($rootScope,$localStorage){$rootScope.app={name:"Biin",description:"Biin Content Management System",year:(new Date).getFullYear(),layout:{isFixed:!0,isCollapsed:!1,isBoxed:!1,isRTL:!1,horizontal:!1,isFloat:!1,asideHover:!1,theme:"themes/theme-e.css"},useFullLayout:!1,hiddenFooter:!1,offsidebarOpen:!1,asideToggled:!1,viewAnimation:"ng-fadeInUp"},$rootScope.$watch("app.layout.isCollapsed",function(newValue){newValue===!1&&$rootScope.$broadcast("closeSidebarMenu")})}angular.module("app.settings").run(settingsRun),settingsRun.$inject=["$rootScope","$localStorage"]}(),angular.module("showcases").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.showcases",{url:"/showcases",templateUrl:"modules/showcases/views/showcases.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function ShowcasesController($http,$scope,Authentication,Organization,ObjectsSidebar,ElementsService,BiinsService,Loading){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.objectsSidebarService=ObjectsSidebar}activate(),$scope.loadingService=Loading,$scope.loadingService.isLoading=!0,$scope.sidebarTemplate="<div class='col-md-3 thumbListImage'><img ng-if='item.elements.length == 0  || item.elements[0].media.length == 0 ' src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjcwIiB5PSI3MCIgc3R5bGU9ImZpbGw6I2FhYTtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjE0MHgxNDA8L3RleHQ+PC9zdmc+' alt=''/><img ng-if='item.elements[0].media.length>0' ng-src='{{item.elements[0].media[0].url}}'/></div><div class='col-md-9 leftInformationArea'><label class='oneRowTitle'>{{item.name}}</label></div>",$scope.objectsSidebarService.template=$scope.sidebarTemplate,$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.$on("organizationChanged",function(){$scope.loadingService.isLoading=!0,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/showcases").success(function(data){$scope.objectsSidebarService.setObjects(data.data),$scope.objectsSidebarService.loadedInformation=!0,$scope.showcasePrototype=data.prototypeObj,$scope.showcasePrototypeBkp=$.extend(!0,{},data.prototypeObj)}),$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/sites").success(function(data){$scope.sites=data.data.sites,$scope.sitesBooleanArray=[];for(var i=0;i<$scope.sites.length;i++)$scope.sitesBooleanArray.push(!1)}),ElementsService.getList($scope.organizationService.selectedOrganization.identifier).then(function(promise){$scope.elements=promise.data.data.elements}),BiinsService.getList($scope.organizationService.selectedOrganization.identifier).then(function(promise){$scope.biinSite=promise.data.data})}),$scope.$on("Biin: On Object Clicked",function(event,objectClicked){$scope.sitesBooleanArray=[];for(var i=0;i<$scope.sites.length;i++)$scope.sitesBooleanArray.push($scope.isShowcaseAssigned($scope.sites[i],objectClicked))}),$scope.$on("Biin: On Object Created",function(){$scope.create()}),$scope.slider1="50",$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/showcases").success(function(data){$scope.objectsSidebarService.setObjects(data.data),$scope.showcasePrototype=data.prototypeObj,$scope.showcasePrototypeBkp=$.extend(!0,{},data.prototypeObj),$scope.loadingService.isLoading=!1}),$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/sites").success(function(data){$scope.sites=data.data.sites,$scope.sitesBooleanArray=[];for(var i=0;i<$scope.sites.length;i++)$scope.sitesBooleanArray.push(!1)}),ElementsService.getList($scope.organizationService.selectedOrganization.identifier).then(function(promise){$scope.elements=promise.data.data.elements}),BiinsService.getList($scope.organizationService.selectedOrganization.identifier).then(function(promise){$scope.biinSite=promise.data.data}),$scope.create=function(){$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/showcases").success(function(showcase,status){201==status&&$scope.objectsSidebarService.objects.push(showcase)})},$scope.deleteShowcase=function(message,selectedObject){confirm(message)&&$scope.removeShowcaseAt($scope.objectsSidebarService.objects.indexOf(selectedObject))},$scope.removeShowcaseAt=function(index){$scope.objectsSidebarService.selectedObject==$scope.objectsSidebarService.objects[index]&&($scope.objectsSidebarService.selectedObject=null);var showcaseId=$scope.objectsSidebarService.objects[index].identifier;$scope.objectsSidebarService.objects.splice(index,1),$http["delete"](ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/showcases/"+showcaseId).success(function(data){"success"==data.state})},$scope.hasValidElements=function(selectedShowcase){var validElement=_.findWhere(selectedShowcase,{isReady:1});return validElement?!0:!1},$scope.hasMissingData=function(){if(null!=$scope.objectsSidebarService.selectedObject){var missingMinData=!1;return null==$scope.objectsSidebarService.selectedObject.name?($scope.objectsSidebarService.selectedObject.name="",
missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.name.trim()&&(missingMinData=!0),0===$scope.objectsSidebarService.selectedObject.elements.length?missingMinData=!0:$scope.hasValidElements($scope.objectsSidebarService.selectedObject.elements)||(missingMinData=!0),missingMinData}},$scope.save=function(){for(var i=0;i<$scope.sites.length;i++)for(var j=0;j<$scope.sites[i].showcases.length;j++){for(var showcaseIdentifier=$scope.sites[i].showcases[j].showcaseIdentifier,elements=[],index=-1,k=0;k<$scope.objectsSidebarService.objects.length;k++)if($scope.objectsSidebarService.objects[k].identifier==showcaseIdentifier){index=k;break}if(index>-1)for(k=0;k<$scope.objectsSidebarService.objects[index].elements.length;k++)elements.push({identifier:$scope.objectsSidebarService.objects[index].elements[k].elementIdentifier});$scope.sites[i].showcases[j].elements=elements}$scope.hasMissingData()?$scope.objectsSidebarService.selectedObject.isReady=0:$scope.objectsSidebarService.selectedObject.isReady=1,$scope.objectsSidebarService.selectedObject.isDeleted=0,$http.put(ApplicationConfiguration.applicationBackendURL+"api/showcases/"+$scope.objectsSidebarService.selectedObject.identifier,{model:$scope.objectsSidebarService.selectedObject}).success(function(data){"replaceModel"in data&&($scope.objectsSidebarService.selectedObject=data.replaceModel,$scope.showcasePrototype=$.extend(!0,{},$scope.showcasePrototypeBkp))}),$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/site/showcases",{model:{identifier:$scope.organizationService.selectedOrganization.identifier,sites:$scope.sites}}).success(function(data,status){})},$scope.filteredElements=function(element){for(var index=-1,i=0;i<$scope.objectsSidebarService.selectedObject.elements.length;i++)if($scope.objectsSidebarService.selectedObject.elements[i].elementIdentifier==element.elementIdentifier){index=i;break}return-1==index},$scope.removeElementAt=function(index){$scope.objectsSidebarService.selectedObject.elements.splice(index,1)},$scope.getFirstElementByPosition=function(element){var foundPosition=0;if(1===element.objects.length)return element.objects[0];for(var foundFirst=!1,i=0;i<element.objects.length&&foundFirst===!1;i++)1===eval(element.objects[i].position)&&(foundFirst=!0,foundPosition=i);return element.objects[foundPosition]},$scope.isShowcaseAssigned=function(site,showcase){for(var index=-1,i=0;i<site.showcases.length;i++)if(site.showcases[i].showcaseIdentifier==showcase.identifier){index=i;break}return index>-1?"active":""},$scope.sortShowcases=function(site,showcase){return function(showcase){for(var index=-1,i=0;i<site.showcases.length;i++)if(site.showcases[i].showcaseIdentifier==showcase.identifier){index=i;break}return index>-1?index:site.showcases.length+$scope.objectsSidebarService.objects.indexOf(showcase)}},$scope.setShowcaseAssigned=function(site,showcase){for(var index=-1,i=0;i<site.showcases.length;i++)if(site.showcases[i].showcaseIdentifier==showcase.identifier){index=i;break}index>-1?site.showcases.splice(index,1):site.showcases.push({showcaseIdentifier:showcase.identifier})},$scope.moveShowcaseDown=function(site,showcase){for(var index,i=0;i<site.showcases.length;i++)if(site.showcases[i].showcaseIdentifier==showcase.identifier){index=i;break}index+1<site.showcases.length&&(site.showcases.splice(index,1),site.showcases.splice(index+1,0,{showcaseIdentifier:showcase.identifier}))},$scope.moveShowcaseUp=function(site,showcase){for(var index,i=0;i<site.showcases.length;i++)if(site.showcases[i].showcaseIdentifier==showcase.identifier){index=i;break}index>=1&&(site.showcases.splice(index,1),site.showcases.splice(index-1,0,{showcaseIdentifier:showcase.identifier}))}}angular.module("showcases").controller("ShowcasesController",ShowcasesController),ShowcasesController.$inject=["$http","$scope","Authentication","Organization","ObjectsSidebar","ElementsService","BiinsService","Loading"]}(),function(){function BiinsService($http){return{getList:function(organizationId){var promise=$http({method:"GET",url:ApplicationConfiguration.applicationBackendURL+"api/organizations/"+organizationId+"/biins"}).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return{status:!1}});return promise},saveList:function(organizationId,biinSite){var promise=$http({method:"POST",url:ApplicationConfiguration.applicationBackendURL+"api/organizations/"+organizationId+"/sites/biins",data:biinSite}).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return{status:!1}});return promise}}}angular.module("showcases").service("BiinsService",BiinsService),BiinsService.$inject=["$http"]}(),function(){function ElementsService($http){return{getList:function(organizationId){var promise=$http({method:"GET",url:ApplicationConfiguration.applicationBackendURL+"api/organizations/"+organizationId+"/elements"}).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return{status:!1}});return promise}}}angular.module("showcases").service("ElementsService",ElementsService),ElementsService.$inject=["$http"]}(),function(){function SidebarController($rootScope,$scope,$state,SidebarLoader,Utils,Authentication){function activate(){function sidebarReady(items){$scope.menu=items}function isActive(item){if(item){if(item.sref&&"#"!==item.sref)return $state.is(item.sref)||$state.includes(item.sref);var foundActive=!1;return angular.forEach(item.submenu,function(value){isActive(value)&&(foundActive=!0)}),foundActive}}function closeAllBut(index){index+="";for(var i in collapseList)(0>index||index.indexOf(i)<0)&&(collapseList[i]=!0)}function isChild($index){return"string"==typeof $index&&!($index.indexOf("-")<0)}var collapseList=[];$scope.authentication=Authentication,$rootScope.$watch("app.layout.asideHover",function(oldVal,newVal){newVal===!1&&oldVal===!0&&closeAllBut(-1)}),SidebarLoader.getMenu(sidebarReady),$scope.getMenuItemPropClasses=function(item){return(item.heading?"nav-heading":"")+(isActive(item)?" active":"")},$scope.addCollapse=function($index,item){collapseList[$index]=$rootScope.app.layout.asideHover?!0:!isActive(item)},$scope.isCollapse=function($index){return collapseList[$index]},$scope.toggleCollapse=function($index,isParentItem){return Utils.isSidebarCollapsed()||$rootScope.app.layout.asideHover?!0:(angular.isDefined(collapseList[$index])?$scope.lastEventFromChild||(collapseList[$index]=!collapseList[$index],closeAllBut($index)):isParentItem&&closeAllBut(-1),$scope.lastEventFromChild=isChild($index),!0)}}activate()}angular.module("app.sidebar").controller("SidebarController",SidebarController),SidebarController.$inject=["$rootScope","$scope","$state","SidebarLoader","Utils","Authentication"]}(),function(){function UserBlockController($rootScope){function activate(){$rootScope.user={name:"John",job:"ng-developer",picture:"app/img/user/02.jpg"},$rootScope.toggleUserBlock=function(){$rootScope.$broadcast("toggleUserBlock")},$rootScope.userBlockVisible=!0,$rootScope.$on("toggleUserBlock",function(){$rootScope.userBlockVisible=!$rootScope.userBlockVisible})}activate()}angular.module("app.sidebar").controller("UserBlockController",UserBlockController),UserBlockController.$inject=["$rootScope"]}(),function(){function sidebar($rootScope,$timeout,$window,Utils){function link(scope,element,attrs){function watchExternalClicks(newVal){newVal===!0?$timeout(function(){wrapper.on(sbclickEvent,function(e){$(e.target).parents(".aside").length||asideToggleOff()})}):wrapper.off(sbclickEvent)}function asideToggleOff(){$rootScope.app.asideToggled=!1,scope.$$phase||scope.$apply()}var currentState=$rootScope.$state.current.name,$sidebar=element,eventName=Utils.isTouch()?"click":"mouseenter",subNav=$();if($sidebar.on(eventName,".nav > li",function(){(Utils.isSidebarCollapsed()||$rootScope.app.layout.asideHover)&&(subNav.trigger("mouseleave"),subNav=toggleMenuItem($(this),$sidebar),sidebarAddBackdrop())}),scope.$on("closeSidebarMenu",function(){removeFloatingNav()}),$win.on("resize",function(){Utils.isMobile()||asideToggleOff()}),$rootScope.$on("$stateChangeStart",function(event,toState){currentState=toState.name,asideToggleOff(),$rootScope.$broadcast("closeSidebarMenu")}),angular.isDefined(attrs.sidebarAnyclickClose)){var wrapper=$(".wrapper"),sbclickEvent="click.sidebar";$rootScope.$watch("app.asideToggled",watchExternalClicks)}}function sidebarAddBackdrop(){var $backdrop=$("<div/>",{"class":"dropdown-backdrop"});$backdrop.insertAfter(".aside-inner").on("click mouseenter",function(){removeFloatingNav()})}function toggleTouchItem($element){$element.siblings("li").removeClass("open").end().toggleClass("open")}function toggleMenuItem($listItem,$sidebar){removeFloatingNav();var ul=$listItem.children("ul");if(!ul.length)return $();if($listItem.hasClass("open"))return toggleTouchItem($listItem),$();var $aside=$(".aside"),$asideInner=$(".aside-inner"),mar=parseInt($asideInner.css("padding-top"),0)+parseInt($aside.css("padding-top"),0),subNav=ul.clone().appendTo($aside);toggleTouchItem($listItem);var itemTop=$listItem.position().top+mar-$sidebar.scrollTop(),vwHeight=$win.height();return subNav.addClass("nav-floating").css({position:$rootScope.app.layout.isFixed?"fixed":"absolute",top:itemTop,bottom:subNav.outerHeight(!0)+itemTop>vwHeight?0:"auto"}),subNav.on("mouseleave",function(){toggleTouchItem($listItem),subNav.remove()}),subNav}function removeFloatingNav(){$(".dropdown-backdrop").remove(),$(".sidebar-subnav.nav-floating").remove(),$(".sidebar li.open").removeClass("open")}var $win=angular.element($window),directive={link:link,restrict:"EA",template:'<nav class="sidebar" ng-transclude></nav>',transclude:!0,replace:!0};return directive}angular.module("app.sidebar").directive("sidebar",sidebar),sidebar.$inject=["$rootScope","$timeout","$window","Utils"]}(),function(){function SidebarLoader(Menus){function getMenu(onReady,onError){onError=onError||function(){alert("Failure loading menu")};var menu=Menus.getMenu("sidebar");menu?onReady(menu):onError()}this.getMenu=getMenu}angular.module("app.sidebar").service("SidebarLoader",SidebarLoader),SidebarLoader.$inject=["Menus"]}(),angular.module("sites").config(["$stateProvider",function($stateProvider){$stateProvider.state("app.sites",{url:"/sites",templateUrl:"modules/sites/views/sites.client.view.html",resolve:{permissions:function(Permission){return Permission.getPermissions()},selectedOrganization:function(Organization){return Organization.getSelectedOrganization()},organization:function(Organization){return Organization.getOrganizations()}}})}]),function(){function SitesController($http,$state,$timeout,$scope,Authentication,Organization,Categories,ObjectsSidebar,Gallery,Loading){function activate(){$scope.authentication=Authentication,$scope.organizationService=Organization,$scope.deletePermit=!1,$scope.loadingService=Loading,$scope.loadingService.isLoading=!0;for(var permit=0;permit<Authentication.user.permissions.length;permit++)if("delete"==Authentication.user.permissions[permit].permission){$scope.deletePermit=!0;break}}activate(),$scope.objectsSidebarService=ObjectsSidebar,$scope.sidebarTemplate="<div class='col-md-3 thumbListImage'><img ng-if='item.media.length == 0' src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjcwIiB5PSI3MCIgc3R5bGU9ImZpbGw6I2FhYTtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjE0MHgxNDA8L3RleHQ+PC9zdmc+' alt=''/><img ng-if='item.media.length>0' ng-src='{{item.media[0].url}}' pending-indicator='pending-indicator'/></div><div class='col-md-9 leftInformationArea'><label class='twoRowTitle'>{{item.title1}}</label><label class='twoRowSubtitle'>{{item.title2}}</label></div>",$scope.objectsSidebarService.template=$scope.sidebarTemplate,$scope.objectsSidebarService.isHidden=!1,$scope.$on("$stateChangeStart",function(){$scope.loadingService.isLoading=!0,$scope.objectsSidebarService.reset()}),$scope.$on("organizationChanged",function(){$scope.loadingService.isLoading=!0,$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/sites").success(function(data){var sites=data.data.sites;$scope.objectsSidebarService.setObjects(sites),$scope.loadingService.isLoading=!1,sites.length>0&&selectFirstSite(sites)}),Gallery.getList($scope.organizationId).then(function(promise){$scope.galleries=promise.data.data})}),$scope.$on("Biin: On Object Clicked",function(event,objectClicked){$timeout(function(){var siteSearchTag=$("#siteSearchTag");siteSearchTag.tagsinput("removeAll");for(var i=0;i<$scope.objectsSidebarService.selectedObject.searchTags.length;i++)siteSearchTag.tagsinput("add",$scope.objectsSidebarService.selectedObject.searchTags[i])},100)}),$scope.$on("Biin: On Object Created",function(){$scope.create()}),$scope.$on("Biin: galleryUpdate",function(a,modalInfo){$scope.galleries=modalInfo.galleries}),$scope.organizationId=$scope.organizationService.selectedOrganization.identifier,$scope.newTagField=[],$scope.loadingImages=!1,$scope.dragCategoryIndex=-1,$scope.dragGalleryIndex=-1,$http.get(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/sites").success(function(data){data.data&&($scope.objectsSidebarService.setObjects(data.data.sites),$scope.loadingService.isLoading=!1,data.data.sites.length>0&&selectFirstSite(data.data.sites))}),Categories.getList().then(function(promise){$scope.categories=promise.data.data}),Gallery.getList($scope.organizationService.selectedOrganization.identifier).then(function(promise){$scope.galleries=promise.data.data});var selectFirstSite=function(sites){$scope.objectsSidebarService.selectedObject=sites[0],$timeout(function(){for(var siteSearchTag=$("#siteSearchTag"),i=0;i<$scope.objectsSidebarService.selectedObject.searchTags.length;i++)siteSearchTag.tagsinput("add",$scope.objectsSidebarService.selectedObject.searchTags[i])},100)};$scope.ownCategories=function(){return $scope.objectsSidebarService.selectedObject.categories},$scope.create=function(){$http.post(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/sites").success(function(site,status){if(201==status){var siteSearchTag=$("#siteSearchTag");siteSearchTag.tagsinput("removeAll");var sites=$scope.objectsSidebarService.getObjects();sites.push(site),$scope.objectsSidebarService.setObjects(sites),$scope.objectsSidebarService.setSelectedObject(site)}else displayErrorMessage(site,"Sites Creation",status)})},$scope.deleteSite=function(message,selectedObject){confirm(message)&&$scope.removeSiteAt($scope.objectsSidebarService.objects.indexOf(selectedObject))},$scope.removeSiteAt=function(index){var sites=$scope.objectsSidebarService.getObjects(),siteIdToDelete=sites[index].identifier,deleteSelectedObject=siteIdToDelete==$scope.objectsSidebarService.selectedObject.identifier;$http["delete"](ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationId+"/sites/"+siteIdToDelete).success(function(data){"success"==data.state?(sites.splice(index,1),deleteSelectedObject&&($scope.objectsSidebarService.selectedObject=null),$scope.objectsSidebarService.setObjects(sites)):console.error("Couldn't delete site")})},$scope.hasMissingData=function(){if(null!=$scope.objectsSidebarService.selectedObject){var missingMinData=!1;return null==$scope.objectsSidebarService.selectedObject.title1?($scope.objectsSidebarService.selectedObject.title1="",missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.title1.trim()&&($scope.objectsSidebarService.selectedObject.title1="",missingMinData=!0),null==$scope.objectsSidebarService.selectedObject.title2?($scope.objectsSidebarService.selectedObject.title2="",missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.title2.trim()&&($scope.objectsSidebarService.selectedObject.title2="",missingMinData=!0),0==$scope.objectsSidebarService.selectedObject.media.length&&(missingMinData=!0),null==$scope.objectsSidebarService.selectedObject.country?($scope.objectsSidebarService.selectedObject.country="",missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.country.trim()&&($scope.objectsSidebarService.selectedObject.country="",missingMinData=!0),null==$scope.objectsSidebarService.selectedObject.state?($scope.objectsSidebarService.selectedObject.state="",missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.state.trim()&&($scope.objectsSidebarService.selectedObject.state="",missingMinData=!0),null==$scope.objectsSidebarService.selectedObject.city?($scope.objectsSidebarService.selectedObject.city="",missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.city.trim()&&($scope.objectsSidebarService.selectedObject.city="",missingMinData=!0),null==$scope.objectsSidebarService.selectedObject.streetAddres?($scope.objectsSidebarService.selectedObject.streetAddres="",missingMinData=!0):""===$scope.objectsSidebarService.selectedObject.streetAddres.trim()&&($scope.objectsSidebarService.selectedObject.streetAddres="",missingMinData=!0),(0==$scope.objectsSidebarService.selectedObject.lat||0==$scope.objectsSidebarService.selectedObject.lng)&&(missingMinData=!0),missingMinData}},$scope.save=function(){var tags=$("#siteSearchTag").tagsinput("items");$scope.objectsSidebarService.selectedObject.searchTags=[];for(var i=0;i<tags.length;i++)$scope.objectsSidebarService.selectedObject.searchTags.push(tags[i]);$scope.hasMissingData()?$scope.objectsSidebarService.selectedObject.isReady=0:$scope.objectsSidebarService.selectedObject.isReady=1,$http.put(ApplicationConfiguration.applicationBackendURL+"api/organizations/"+$scope.organizationService.selectedOrganization.identifier+"/sites/"+$scope.objectsSidebarService.selectedObject.identifier,{model:$scope.objectsSidebarService.selectedObject}).success(function(data,status){"replaceModel"in data&&($scope.objectsSidebarService.selectedObject=data.replaceModel),"success"==data.state&&($scope.succesSaveShow=!0)})},$scope.limitNutshell=function(){var value=$scope.objectsSidebarService.selectedObject.nutshell;null===value&&(value=""),value=value.trim();var words=value.split(" ");words.length>8&&words.splice(8,words.length-8);for(var sentence="",i=0;i<words.length;i++)sentence+=words[i]+" ";sentence=sentence.trim(),$scope.objectsSidebarService.selectedObject.nutshell=sentence},$scope.changeLocation=function(lat,lng){$scope.objectsSidebarService.selectedObject.lat=lat,$scope.objectsSidebarService.selectedObject.lng=lng,$scope.$digest(),$scope.$apply()},$scope.containsCategory=function(category){return"undefined"!=typeof _.findWhere($scope.objectsSidebarService.selectedObject.categories,{identifier:category.identifier})?!0:!1},$scope.updateSelectedCategories=function(category){var index=-1,cat=_.findWhere($scope.objectsSidebarService.selectedObject.categories,{identifier:category.identifier});"undefined"!=typeof cat&&(index=$scope.objectsSidebarService.selectedObject.categories.indexOf(cat)),index>=0?$scope.objectsSidebarService.selectedObject.categories.splice(index,1):$scope.objectsSidebarService.selectedObject.categories.push(category)},$scope.removeMediaAt=function(index){$scope.objectsSidebarService.selectedObject.media.length>=index&&$scope.objectsSidebarService.selectedObject.media.splice(index,1)}}angular.module("sites").controller("SitesController",SitesController),SitesController.$inject=["$http","$state","$timeout","$scope","Authentication","Organization","Categories","ObjectsSidebar","Gallery","Loading"]}(),function(){function translateConfig($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/i18n/",suffix:".json"}),$translateProvider.preferredLanguage("es_AR"),$translateProvider.useLocalStorage(),$translateProvider.usePostCompiling(!0)}angular.module("app.translate").config(translateConfig),translateConfig.$inject=["$translateProvider"]}(),function(){function translateRun($rootScope,$translate){$rootScope.language={listIsOpen:!1,available:{es_AR:"Español",en:"English"},init:function(){var proposedLanguage=$translate.proposedLanguage()||$translate.use(),preferredLanguage=$translate.preferredLanguage();$rootScope.language.selected=$rootScope.language.available[proposedLanguage||preferredLanguage]},set:function(localeId){$translate.use(localeId),$rootScope.language.selected=$rootScope.language.available[localeId],$rootScope.language.listIsOpen=!$rootScope.language.listIsOpen}},$rootScope.language.init()}angular.module("app.translate").run(translateRun),translateRun.$inject=["$rootScope","$translate"]}(),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("page.signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("page.signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("page.forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("page.reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("page.reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("page.reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"}).state("app.password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("app.accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]),function(){function animateEnabled($animate){function link(scope,element,attrs){scope.$watch(function(){return scope.$eval(attrs.animateEnabled,scope)},function(newValue){$animate.enabled(!!newValue,element)})}var directive={link:link,restrict:"A"};return directive}angular.module("app.utils").directive("animateEnabled",animateEnabled),animateEnabled.$inject=["$animate"]}(),function(){function resetKey($state,$localStorage){function link(scope,element){element.on("click",function(e){e.preventDefault(),scope.resetKey?(delete $localStorage[scope.resetKey],$state.go($state.current,{},{reload:!0})):$.error("No storage key specified for reset.")})}var directive={link:link,restrict:"A",scope:{resetKey:"@"}};return directive}angular.module("app.utils").directive("resetKey",resetKey),resetKey.$inject=["$state","$localStorage"]}(),function(){function toggleFullscreen(Browser){function link(scope,element){Browser.msie?element.addClass("hide"):element.on("click",function(e){e.preventDefault(),screenfull.enabled?(screenfull.toggle(),screenfull.isFullscreen?$(this).children("em").removeClass("fa-expand").addClass("fa-compress"):$(this).children("em").removeClass("fa-compress").addClass("fa-expand")):$.error("Fullscreen not enabled")})}var directive={link:link,restrict:"A"};return directive}angular.module("app.utils").directive("toggleFullscreen",toggleFullscreen),toggleFullscreen.$inject=["Browser"]}(),function(){function loadCss(){function link(scope,element,attrs){element.on("click",function(e){element.is("a")&&e.preventDefault();var link,uri=attrs.loadCss;uri?(link=createLink(uri),link||$.error("Error creating stylesheet link element.")):$.error("No stylesheet location defined.")})}function createLink(uri){var linkId="autoloaded-stylesheet",oldLink=$("#"+linkId).attr("id",linkId+"-old");return $("head").append($("<link/>").attr({id:linkId,rel:"stylesheet",href:uri})),oldLink.length&&oldLink.remove(),$("#"+linkId)}var directive={link:link,restrict:"A"};return directive}angular.module("app.utils").directive("loadCss",loadCss)}(),function(){function now(dateFilter,$interval){function link(scope,element,attrs){function updateTime(){var dt=dateFilter(new Date,format);element.text(dt)}var format=attrs.format;updateTime();var intervalPromise=$interval(updateTime,1e3);scope.$on("$destroy",function(){$interval.cancel(intervalPromise)})}var directive={link:link,restrict:"EA"};return directive}angular.module("app.utils").directive("now",now),now.$inject=["dateFilter","$interval"]}(),function(){function checkAll(){function link(scope,element){element.on("change",function(){var $this=$(this),index=$this.index()+1,checkbox=$this.find('input[type="checkbox"]'),table=$this.parents("table");table.find("tbody > tr > td:nth-child("+index+') input[type="checkbox"]').prop("checked",checkbox[0].checked)})}var directive={link:link,restrict:"A"};return directive}angular.module("app.utils").directive("checkAll",checkAll)}(),function(){function triggerResize($window,$timeout){function link(scope,element){element.on("click",function(){$timeout(function(){$window.dispatchEvent(new Event("resize"))})})}var directive={link:link,restrict:"A"};return directive}angular.module("app.utils").directive("triggerResize",triggerResize),triggerResize.$inject=["$window","$timeout"]}(),function(){function Browser($window){return $window.jQBrowser}angular.module("app.utils").service("Browser",Browser),Browser.$inject=["$window"]}(),function(){function Utils($window,APP_MEDIAQUERY){var $html=angular.element("html"),$win=angular.element($window),$body=angular.element("body");return{support:{transition:function(){var transitionEnd=function(){var name,element=document.body||document.documentElement,transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(name in transEndEventNames)if(void 0!==element.style[name])return transEndEventNames[name]}();return transitionEnd&&{end:transitionEnd}}(),animation:function(){var animationEnd=function(){var name,element=document.body||document.documentElement,animEndEventNames={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd oanimationend",animation:"animationend"};for(name in animEndEventNames)if(void 0!==element.style[name])return animEndEventNames[name]}();return animationEnd&&{end:animationEnd}}(),requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},touch:"ontouchstart"in window&&navigator.userAgent.toLowerCase().match(/mobile|tablet/)||window.DocumentTouch&&document instanceof window.DocumentTouch||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0||!1,mutationobserver:window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null},isInView:function(element,options){var $element=$(element);if(!$element.is(":visible"))return!1;var window_left=$win.scrollLeft(),window_top=$win.scrollTop(),offset=$element.offset(),left=offset.left,top=offset.top;return options=$.extend({topoffset:0,leftoffset:0},options),top+$element.height()>=window_top&&top-options.topoffset<=window_top+$win.height()&&left+$element.width()>=window_left&&left-options.leftoffset<=window_left+$win.width()?!0:!1},langdirection:"rtl"===$html.attr("dir")?"right":"left",isTouch:function(){return $html.hasClass("touch")},isSidebarCollapsed:function(){return $body.hasClass("aside-collapsed")},isSidebarToggled:function(){return $body.hasClass("aside-toggled")},isMobile:function(){return $win.width()<APP_MEDIAQUERY.tablet}}}angular.module("app.utils").service("Utils",Utils),Utils.$inject=["$window","APP_MEDIAQUERY"]}();